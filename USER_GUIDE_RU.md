# Руководство пользователя Trading Bot

## Для тех, кто никогда не торговал

> Это руководство написано простым языком для людей, которые впервые слышат о трейдинге. Здесь вы найдёте всё необходимое для понимания и использования торгового робота.

---

## Оглавление

1. [Что такое трейдинг? (Словарь новичка)](#часть-1-что-такое-трейдинг-словарь-новичка)
2. [Что делает этот робот?](#часть-2-что-делает-этот-робот)
3. [Установка и запуск](#часть-3-установка-и-запуск)
4. [Настройка бота (Конфигурация)](#часть-4-настройка-бота-конфигурация)
5. [Режимы работы бота](#часть-5-режимы-работы-бота)
6. [Понимание результатов](#часть-6-понимание-результатов)
7. [Пошаговый пример работы](#часть-7-пошаговый-пример-работы)
8. [Частые вопросы](#часть-8-частые-вопросы)
9. [Предупреждения о рисках](#часть-9-предупреждения-о-рисках)

---

# Часть 1: Что такое трейдинг? (Словарь новичка)

## Основные понятия

### Что такое криптовалюта?

Криптовалюта — это цифровые деньги, которые существуют только в интернете. Самые известные:
- **Bitcoin (BTC)** — первая и самая дорогая криптовалюта
- **Ethereum (ETH)** — вторая по популярности
- **USDT (Tether)** — "стейблкоин", привязанный к доллару США (1 USDT ≈ 1 USD)

### Что такое трейдинг?

**Трейдинг** — это покупка и продажа чего-либо с целью заработать на разнице цен.

```
Простой пример:

Вы купили Bitcoin за $40,000
         ↓
Через неделю цена выросла до $45,000
         ↓
Вы продали Bitcoin за $45,000
         ↓
Ваша прибыль: $5,000 (минус комиссии)
```

### Что такое биржа?

**Биржа** — это место (сайт), где люди покупают и продают криптовалюту. Наш бот работает с биржей **Binance** — самой большой криптобиржей в мире.

```
┌─────────────────────────────────────────────────┐
│                    BINANCE                       │
│                                                  │
│   Продавцы ←──── Биржа ────→ Покупатели         │
│      │              ↑              │            │
│      └──────────────┴──────────────┘            │
│                     │                           │
│            Робот торгует здесь                  │
└─────────────────────────────────────────────────┘
```

### Что такое торговая пара?

Торговая пара показывает, что на что вы меняете.

**BTCUSDT** означает:
- **BTC** — Bitcoin (что покупаем/продаём)
- **USDT** — за какую валюту (за доллары)

```
BTCUSDT = 45000 означает:
"1 Bitcoin стоит 45,000 долларов"
```

Другие примеры:
- **ETHUSDT** — Ethereum за доллары
- **SOLUSDT** — Solana за доллары

---

## Как читать график цены

### Что такое свеча (Candle)?

На бирже цену показывают не линией, а **свечами**. Каждая свеча показывает изменение цены за определённый период времени.

```
    Зелёная свеча              Красная свеча
    (цена ВЫРОСЛА)             (цена УПАЛА)

         │                          │
         │ верхняя тень             │ верхняя тень
         │ (максимум)               │ (максимум)
    ┌────┴────┐                ┌────┴────┐
    │░░░░░░░░░│ ← закрытие     │█████████│ ← открытие
    │░░░░░░░░░│   (выше)       │█████████│   (выше)
    │░░░░░░░░░│                │█████████│
    │░░░░░░░░░│ ← открытие     │█████████│ ← закрытие
    └────┬────┘   (ниже)       └────┬────┘   (ниже)
         │                          │
         │ нижняя тень              │ нижняя тень
         │ (минимум)                │ (минимум)
```

**Свеча содержит 4 цены**:
1. **Open (Открытие)** — цена в начале периода
2. **High (Максимум)** — самая высокая цена
3. **Low (Минимум)** — самая низкая цена
4. **Close (Закрытие)** — цена в конце периода

### Что такое таймфрейм?

**Таймфрейм** — это период времени для одной свечи:

| Таймфрейм | Одна свеча = | Для чего |
|-----------|--------------|----------|
| 1h (1 час) | 1 час | Краткосрочная торговля |
| 4h (4 часа) | 4 часа | Среднесрочная (рекомендуется) |
| 1d (1 день) | 1 день | Долгосрочная торговля |

```
Пример графика из свечей (4-часовой таймфрейм):

Цена
  ↑
  │     ┌─┐
  │ ┌─┐ │░│ ┌─┐
  │ │░│ │░│ │█│     ┌─┐
  │ │░│ │░│ │█│ ┌─┐ │░│
  │ │░│ │░│ │█│ │█│ │░│
  │ └─┘ └─┘ └─┘ │█│ │░│
  │             └─┘ └─┘
  └──────────────────────→ Время
    00:00  04:00  08:00  12:00  16:00  20:00

  ░ = зелёная (рост)
  █ = красная (падение)
```

---

## Что такое тренд?

**Тренд** — это общее направление движения цены.

```
ВОСХОДЯЩИЙ ТРЕНД (Uptrend)        НИСХОДЯЩИЙ ТРЕНД (Downtrend)
Цена в целом растёт               Цена в целом падает

      ↗                                  ↘
    ↗                                      ↘
  ↗     Покупай!                             ↘    Продавай!
↗                                              ↘


БОКОВИК (Sideways / Ranging)
Цена топчется на месте

    ──────────────────
         Не торгуй!
```

**Важно**: Наш робот торгует **только в тренде**. Если рынок "боковит" — робот ждёт.

---

## Что такое индикаторы?

**Индикаторы** — это математические формулы, которые помогают понять:
- Есть ли сейчас тренд?
- Насколько он сильный?
- Когда входить в сделку?

### Основные индикаторы нашего робота:

#### 1. ADX (Average Directional Index) — Сила тренда

```
ADX показывает СИЛУ тренда (не направление!)

ADX < 20  →  Тренда нет, рынок "спит"     ❌ Не торгуем
ADX 20-25 →  Слабый тренд                 ⚠️ Осторожно
ADX > 25  →  Сильный тренд                ✅ Можно торговать
ADX > 40  →  Очень сильный тренд          ✅✅ Отлично!
```

#### 2. EMA (Exponential Moving Average) — Скользящая средняя

EMA — это "сглаженная" линия цены, которая показывает направление тренда.

```
Цена                          Быстрая EMA (20 периодов)
  ↑                           следует за ценой близко
  │    ╱╲
  │   ╱  ╲  ╱╲                Медленная EMA (50 периодов)
  │  ╱    ╲╱  ╲               следует за ценой издалека
  │ ╱          ╲
  │╱            ╲
  └───────────────→ Время

Когда быстрая EMA пересекает медленную СНИЗУ ВВЕРХ = сигнал на покупку
Когда быстрая EMA пересекает медленную СВЕРХУ ВНИЗ = сигнал на продажу
```

#### 3. ATR (Average True Range) — Волатильность

ATR показывает, насколько сильно "прыгает" цена.

```
ATR маленький = цена движется спокойно
ATR большой = цена сильно колеблется

Робот использует ATR для установки стоп-лосса:
Стоп-лосс = Цена входа - (ATR × 2.5)
```

#### 4. Объём (Volume)

Объём показывает, сколько денег торгуется.

```
Большой объём = много участников, движение надёжное
Маленький объём = мало участников, движение может быть ложным

Робот требует объём >= 1.5× от среднего для входа в сделку
```

---

## Что такое позиция?

**Позиция** — это ваша текущая ставка на рынке.

### Типы позиций:

```
LONG (Длинная позиция)          SHORT (Короткая позиция)
= Ставка на РОСТ цены           = Ставка на ПАДЕНИЕ цены

Купил дёшево → Продал дорого    Продал дорого → Купил дёшево
      ✅ Прибыль                      ✅ Прибыль

Купил дёшево → Цена упала       Продал дорого → Цена выросла
      ❌ Убыток                       ❌ Убыток
```

**Примечание**: Наш робот в режиме Spot торгует только LONG (на рост).

---

## Что такое стоп-лосс и тейк-профит?

### Стоп-лосс (Stop Loss) — Защита от убытков

**Стоп-лосс** — это автоматический приказ продать, если цена упадёт до определённого уровня.

```
Вы купили Bitcoin по $45,000
Установили стоп-лосс на $43,500 (на $1,500 ниже)

Если цена упадёт до $43,500:
→ Робот автоматически продаст
→ Вы потеряете $1,500, но не больше!

Без стоп-лосса:
→ Цена может упасть до $30,000
→ Вы потеряете $15,000
```

```
  Цена
    ↑
    │  ┌── Цена входа: $45,000
    │  │
    │  │   Цена падает...
    │  ↓
    │  ├── Стоп-лосс: $43,500 ← Автоматическая продажа!
    │  │
    │  │   Дальнейшее падение вас не касается
    │  ↓
    └──────→
```

### Тейк-профит (Take Profit) — Фиксация прибыли

**Тейк-профит** — это автоматический приказ продать, когда цена достигнет целевой прибыли.

```
Вы купили Bitcoin по $45,000
Стоп-лосс: $43,500 (риск: $1,500)
Тейк-профит: $47,250 (прибыль: $2,250)

Соотношение прибыль:риск = 1.5:1
(За каждый $1 риска вы получаете $1.5 прибыли)
```

```
  Цена
    ↑
    │  ├── Тейк-профит: $47,250 ← Автоматическая продажа с прибылью!
    │  │
    │  │   Цена растёт...
    │  ↑
    │  ┌── Цена входа: $45,000
    │  │
    │  ├── Стоп-лосс: $43,500
    │  │
    └──────→
```

### Трейлинг-стоп (Trailing Stop)

**Трейлинг-стоп** — это "умный" стоп-лосс, который двигается вслед за ценой.

```
Шаг 1: Купили по $45,000, стоп на $43,500

  ├── $45,000 (вход)
  │
  ├── $43,500 (стоп)


Шаг 2: Цена выросла до $47,000, стоп поднялся до $45,500

  ├── $47,000 (текущая цена)
  │
  ├── $45,500 (новый стоп) ← Поднялся!
  │
  ├── $45,000 (вход)


Шаг 3: Цена выросла до $50,000, стоп на $48,500

  ├── $50,000 (текущая цена)
  │
  ├── $48,500 (новый стоп) ← Ещё выше!

Теперь даже если цена упадёт, вы заработаете минимум $3,500!
```

---

## Что такое риск-менеджмент?

**Риск-менеджмент** — это правила, которые защищают ваши деньги.

### Правило 1: Рисковать только 1-2% капитала на сделку

```
Ваш капитал: $10,000
Риск на сделку: 1.5% = $150

Это значит:
- Если сделка убыточная, вы потеряете максимум $150
- Чтобы потерять весь капитал, нужно 67 убыточных сделок подряд!
```

### Правило 2: Ограничение просадки (Drawdown)

**Просадка** — это падение вашего счёта от максимума.

```
Было: $10,000 (максимум)
Стало: $8,500
Просадка: $1,500 или 15%

Наш робот останавливает торговлю при просадке > 20%
```

### Правило 2.1: Дневной лимит потерь

**Дневной лимит** — это максимально допустимая потеря за один торговый день.

```
Начало дня: $10,000
Дневной лимит: 3% = $300

Если за день потеряли $300:
→ Робот прекращает открывать новые сделки до следующего дня
→ Открытые позиции остаются (со стоп-лоссами)
→ В полночь UTC счётчик обнуляется

Защищает от больших потерь в волатильные дни!
```

### Правило 3: Portfolio Heat (Общий риск)

```
Если у вас открыто несколько сделок:
- Сделка 1: риск $150
- Сделка 2: риск $150
- Сделка 3: риск $150

Общий риск (heat) = $450 или 4.5% от $10,000

Робот не откроет новую сделку, если heat > 15%
```

---

# Часть 2: Что делает этот робот?

## Общее описание

Наш робот — это программа, которая:
1. **Смотрит** на график цены
2. **Анализирует** с помощью индикаторов
3. **Решает** — покупать, продавать или ждать
4. **Выполняет** сделки автоматически

```
┌─────────────────────────────────────────────────────────────┐
│                      КАК РАБОТАЕТ РОБОТ                      │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│   ┌─────────┐     ┌──────────────┐     ┌─────────────┐      │
│   │ Binance │ ──→ │    Робот     │ ──→ │   Binance   │      │
│   │  Данные │     │  Анализирует │     │   Ордера    │      │
│   └─────────┘     └──────────────┘     └─────────────┘      │
│        │                 │                    │              │
│        ↓                 ↓                    ↓              │
│   Свечи, цены      Индикаторы:          Покупка/Продажа     │
│   Объёмы           ADX, EMA, ATR        Стоп-лосс           │
│                    MACD, OBV            Тейк-профит         │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

## Стратегия робота: ADX Trend Following

Робот использует стратегию **"Следование за трендом"** (Trend Following).

### Когда робот ПОКУПАЕТ (открывает Long):

Все условия должны быть выполнены одновременно:

```
✅ ADX > 25                    (есть сильный тренд)
✅ Быстрая EMA > Медленной EMA (тренд вверх)
✅ +DI > -DI                   (покупатели сильнее продавцов)
✅ MACD положительный          (подтверждение роста)
✅ Объём >= 1.5× от среднего   (движение подтверждено деньгами)
✅ OBV растёт                  (деньги "текут" в актив)
```

### Когда робот ПРОДАЁТ (закрывает позицию):

Любое из условий:

```
❌ Цена достигла стоп-лосса    (защита от убытков)
✅ Цена достигла тейк-профита  (фиксация прибыли)
⚠️ ADX упал ниже 18            (тренд ослаб)
⏰ Прошло слишком много времени (опционально)
```

### Визуализация стратегии

```
Цена
  ↑
  │                          ╱╲
  │                    ╱╲   ╱  ╲   ← Тейк-профит достигнут! Продаём.
  │              ╱╲   ╱  ╲ ╱    ╲
  │         ╱╲  ╱  ╲ ╱
  │    ╱╲  ╱  ╲╱
  │   ╱  ╲╱    ↑
  │  ╱         │
  │ ╱          └── Вход: ADX>25, EMA пересеклись вверх,
  │╱               объём высокий
  │
  │ ════════════════════════ Стоп-лосс (2.5 × ATR ниже входа)
  │
  └────────────────────────────────────────────→ Время
```

---

# Часть 3: Установка и запуск

## Требования

Для работы робота нужно:

1. **Компьютер** с Windows, macOS или Linux
2. **.NET 8 SDK** — платформа для запуска программы
3. **Интернет** — постоянное подключение
4. **Аккаунт Binance** (для реальной торговли)

## Шаг 1: Установка .NET 8

### Windows:
1. Откройте https://dotnet.microsoft.com/download/dotnet/8.0
2. Нажмите "Download .NET SDK x64"
3. Запустите скачанный файл
4. Следуйте инструкциям установщика

### macOS:
```bash
# Через Homebrew:
brew install dotnet@8
```

### Linux (Ubuntu/Debian):
```bash
# Добавить репозиторий Microsoft
wget https://packages.microsoft.com/config/ubuntu/22.04/packages-microsoft-prod.deb
sudo dpkg -i packages-microsoft-prod.deb

# Установить SDK
sudo apt update
sudo apt install dotnet-sdk-8.0
```

### Проверка установки:
```bash
dotnet --version
# Должно показать: 8.0.xxx
```

## Шаг 2: Скачивание робота

```bash
# Клонировать репозиторий
git clone https://github.com/makhin/TradingBot.git

# Перейти в папку
cd TradingBot/ComplexBot
```

## Шаг 3: Установка зависимостей

```bash
# Скачать библиотеки
dotnet restore

# Собрать проект
dotnet build
```

## Шаг 4: Первый запуск

```bash
dotnet run
```

Вы увидите главное меню:

```
  _____              _ _               ____        _
 |_   _| __ __ _  __| (_)_ __   __ _  | __ )  ___ | |_
   | || '__/ _` |/ _` | | '_ \ / _` | |  _ \ / _ \| __|
   | || | | (_| | (_| | | | | | (_| | | |_) | (_) | |_
   |_||_|  \__,_|\__,_|_|_| |_|\__, | |____/ \___/ \__|
                               |___/

ADX Trend Following Strategy with Risk Management
Based on research: target Sharpe 1.5-1.9, max DD <20%

Select mode:
> Backtest
  Parameter Optimization
  Walk-Forward Analysis
  Monte Carlo Simulation
  Live Trading (Paper)
  Live Trading (Real)
  Download Data
  Configuration Settings
  Reset to Defaults
  Exit
```

---

# Часть 4: Настройка бота (Конфигурация)

## Зачем нужна конфигурация?

Раньше при каждом запуске бота приходилось вводить все настройки заново: API ключи, параметры риска, стратегии и так далее. Это неудобно!

**Теперь бот использует систему конфигурации**, которая:
- Сохраняет ваши настройки
- Автоматически загружает их при следующем запуске
- Позволяет легко менять параметры
- Хранит API ключи безопасно
- Даёт возможность сбросить всё к дефолтным значениям

```
┌─────────────────────────────────────────────────────┐
│              КАК РАБОТАЕТ КОНФИГУРАЦИЯ               │
├─────────────────────────────────────────────────────┤
│                                                      │
│  📄 appsettings.json                                │
│     ↓                                                │
│  Дефолтные значения (в git)                         │
│  - Безопасные настройки по умолчанию                │
│  - Рекомендованные параметры стратегии              │
│  - Корреляционные группы                            │
│                                                      │
│           +                                          │
│                                                      │
│  📝 appsettings.user.json                           │
│     ↓                                                │
│  Ваши персональные настройки (НЕ в git!)            │
│  - API ключи Binance                                │
│  - Telegram bot token                               │
│  - Ваши изменённые параметры риска                  │
│                                                      │
│           =                                          │
│                                                      │
│  ⚙️ Финальная конфигурация                          │
│     ↓                                                │
│  Бот работает с вашими настройками!                 │
│                                                      │
└─────────────────────────────────────────────────────┘
```

---

## Файлы конфигурации

### appsettings.json — Дефолтные настройки

Этот файл находится в папке `ComplexBot/` и содержит безопасные значения по умолчанию:

```json
{
  "BinanceApi": {
    "ApiKey": "",
    "ApiSecret": "",
    "UseTestnet": true
  },
  "RiskManagement": {
    "RiskPerTradePercent": 1.5,
    "MaxPortfolioHeatPercent": 15.0,
    "MaxDrawdownPercent": 20.0,
    "MaxDailyDrawdownPercent": 3.0
  },
  "Strategy": {
    "AdxPeriod": 14,
    "AdxThreshold": 25.0,
    "VolumeThreshold": 1.5
  },
  "PortfolioRisk": {
    "CorrelationGroups": {
      "BTC_CORRELATED": ["BTCUSDT", "ETHUSDT", "BNBUSDT", "SOLUSDT"],
      "ALTCOINS_L1": ["ADAUSDT", "DOTUSDT", "AVAXUSDT", "MATICUSDT"]
    }
  }
}
```

**Этот файл:**
- ✅ Хранится в git (безопасно, без секретов)
- ✅ Можно обновлять вручную
- ❌ НЕ изменяется автоматически ботом

### appsettings.user.json — Ваши настройки

Этот файл создаётся автоматически и содержит **ваши** персональные данные:

```json
{
  "BinanceApi": {
    "ApiKey": "ваш_api_ключ",
    "ApiSecret": "ваш_секретный_ключ",
    "UseTestnet": false
  },
  "RiskManagement": {
    "RiskPerTradePercent": 2.0
  },
  "Telegram": {
    "Enabled": true,
    "BotToken": "7123456789:AAHdqTc...",
    "ChatId": 987654321
  }
}
```

**Этот файл:**
- ❌ НЕ хранится в git (в .gitignore для безопасности)
- ✅ Создаётся автоматически при сохранении настроек
- ✅ Переопределяет значения из appsettings.json
- ⚠️ **ВАЖНО**: Содержит ваши API ключи — НЕ делитесь им!

---

## Меню Configuration Settings

### Как открыть?

В главном меню выберите **"Configuration Settings"**:

```
Select mode:
  Backtest
  Parameter Optimization
  ...
> Configuration Settings  ← Выберите это
  Reset to Defaults
  Exit
```

### Подменю настроек:

```
Which settings to configure?
> Risk Management           ← Настройки риск-менеджмента
  Strategy Parameters       ← Параметры стратегии ADX
  Correlation Groups        ← Группы коррелированных активов
  Telegram Notifications    ← Уведомления в Telegram
  API Keys                  ← API ключи Binance
  Back to Menu
```

---

## Настройка API Keys

**Самое важное!** Перед реальной торговлей нужно настроить API ключи.

### Шаги:

1. Выберите **"Configuration Settings"** → **"API Keys"**

2. Вы увидите:

```
Binance API Configuration
Get API keys at: https://www.binance.com/en/my/settings/api-management

API Key: [введите ваш API ключ]
API Secret: ******** [скрыто при вводе]
Use Testnet? [y/n] (default = y): n

✓ Configuration saved to appsettings.user.json
```

3. После сохранения ключи будут **автоматически загружаться** при запуске Live Trading

**Больше не нужно вводить API ключи каждый раз!**

### Безопасность:

```
⚠️ ВАЖНО:
1. ❌ НЕ делитесь appsettings.user.json
2. ❌ НЕ коммитьте этот файл в git
3. ✅ Файл автоматически в .gitignore
4. ✅ API Secret скрыт при вводе
```

---

## Настройка Risk Management

Настройте параметры управления рисками один раз — они сохранятся!

```
Risk Management Settings
Press Enter to keep current value shown in brackets

Risk per trade (%) [1.5]: 2.0
Max portfolio heat (%) [15]: 20
Max drawdown circuit breaker (%) [20]: 20
Max daily drawdown (%) [3]: 3
ATR stop multiplier [2.5]: 2.5
Take profit ratio (reward:risk) [1.5]: 1.5
Minimum equity USD [100]: 100

Save these settings? [y/n] (default = y): y
✓ Configuration saved to appsettings.user.json
```

**Что происходит:**
- Показываются **текущие** сохранённые значения в `[квадратных скобках]`
- Нажмите Enter — значение останется
- Введите новое — оно сохранится
- При следующем запуске бот предложит **ваши сохранённые значения**

---

## Настройка Strategy Parameters

Параметры стратегии ADX Trend Following:

```
Use default strategy settings? [y/n] (default = y): n

Strategy Settings
Press Enter to keep current value shown in brackets

ADX period [14]: 14
ADX entry threshold [25]: 30
ADX exit threshold [18]: 18
Require ADX rising? [y/n] (default = n): n
ADX slope lookback (bars) [5]: 5
Fast EMA period [20]: 20
Slow EMA period [50]: 50
ATR period [14]: 14
Min ATR % of price [0]: 0
Max ATR % of price [100]: 100
Require volume confirmation? [y/n] (default = y): y
Volume spike threshold (x avg) [1.5]: 2.0
Require OBV confirmation? [y/n] (default = y): y

Save these settings? [y/n] (default = y): y
✓ Configuration saved to appsettings.user.json
```

---

## Настройка Telegram Notifications

```
Telegram Configuration
Get bot token from @BotFather
Get chat ID from https://api.telegram.org/bot<TOKEN>/getUpdates

Enable Telegram notifications? [y/n] (default = n): y
Bot Token: 7123456789:AAHdqTcvCH1vGWJxfSeofSAs0K5PALDsaw
Chat ID: 987654321

✓ Configuration saved to appsettings.user.json
```

После сохранения уведомления будут **автоматически включаться** при Live Trading.

---

## Correlation Groups — Корреляционные группы

Это продвинутая настройка для мультивалютной торговли.

```
Correlation Groups Configuration
Edit correlation groups in appsettings.user.json manually
Format: "GroupName": ["SYMBOL1", "SYMBOL2", ...]

Current groups:
  BTC_CORRELATED: BTCUSDT, ETHUSDT, BNBUSDT, SOLUSDT
  ALTCOINS_L1: ADAUSDT, DOTUSDT, AVAXUSDT, MATICUSDT
  ALTCOINS_DEFI: UNIUSDT, AAVEUSDT, LINKUSDT, SUSHIUSDT
  MEMECOINS: DOGEUSDT, SHIBUSDT, PEPEUSDT
```

### Как редактировать группы?

1. Откройте файл `ComplexBot/appsettings.user.json` в текстовом редакторе

2. Найдите секцию `PortfolioRisk`:

```json
{
  "PortfolioRisk": {
    "CorrelationGroups": {
      "BTC_CORRELATED": ["BTCUSDT", "ETHUSDT", "BNBUSDT", "SOLUSDT"],
      "ALTCOINS_L1": ["ADAUSDT", "DOTUSDT", "AVAXUSDT", "MATICUSDT"]
    }
  }
}
```

3. Добавьте/измените группы:

```json
{
  "PortfolioRisk": {
    "CorrelationGroups": {
      "BTC_CORRELATED": [
        "BTCUSDT",
        "ETHUSDT",
        "BNBUSDT",
        "SOLUSDT",
        "ADAUSDT"  ← Добавили ADA в BTC группу
      ],
      "MY_CUSTOM_GROUP": [  ← Новая группа
        "DOTUSDT",
        "AVAXUSDT"
      ]
    }
  }
}
```

4. Сохраните файл и перезапустите бота

---

## Reset to Defaults — Сброс к дефолтам

Если что-то пошло не так или хотите начать с чистого листа:

```
Select mode:
  ...
> Reset to Defaults

! User configuration deleted: appsettings.user.json
✓ Configuration reset to defaults
```

**Что происходит:**
- Удаляется файл `appsettings.user.json`
- Все настройки возвращаются к дефолтным значениям из `appsettings.json`
- **API ключи и Telegram настройки будут удалены** — нужно ввести заново

⚠️ **Внимание**: Резервную копию `appsettings.user.json` можно сделать вручную перед сбросом!

---

## Автоматическая загрузка при Live Trading

### Старое поведение (до конфигурации):

```
Enable Telegram notifications? [y/n]: y
Bot Token: [вводить каждый раз]
Chat ID: [вводить каждый раз]

Use Binance Testnet? [y/n]: y
API Key: [вводить каждый раз]
API Secret: [вводить каждый раз]
```

### Новое поведение (с конфигурацией):

```
═══ PAPER TRADING MODE ═══

Using Testnet API keys from configuration

Symbol [BTCUSDT]:
Interval (current: FourHour): 4h
...
✓ Telegram notifications enabled (from config)
```

**Всё загрузилось автоматически!** Вводить нужно только symbol и interval.

---

## Где хранятся файлы?

```
TradingBot/
├── ComplexBot/
│   ├── appsettings.json           ← Дефолты (в git)
│   ├── appsettings.user.json      ← Ваши настройки (НЕ в git)
│   ├── Configuration/
│   │   ├── BotConfiguration.cs
│   │   └── ConfigurationService.cs
│   └── ...
└── .gitignore                      ← appsettings.user.json здесь
```

---

## Частые вопросы по конфигурации

**Q: Потерял appsettings.user.json, как восстановить?**
A: Заново настройте через меню "Configuration Settings". Файл создастся автоматически.

**Q: Можно ли скопировать настройки на другой компьютер?**
A: Да! Скопируйте `appsettings.user.json` в папку ComplexBot на новом компьютере.

**Q: Безопасно ли хранить API ключи в файле?**
A: Файл находится локально на вашем компьютере и исключён из git. Но используйте шифрование диска для максимальной безопасности.

**Q: Что если я вручную отредактирую appsettings.json?**
A: Можно! Но при обновлении бота изменения могут быть перезаписаны. Лучше использовать appsettings.user.json.

**Q: Как посмотреть текущие настройки?**
A: Откройте `appsettings.user.json` в текстовом редакторе (Notepad, VSCode, и т.д.).

**Q: Бот не видит мои настройки, что делать?**
A:
1. Проверьте, что `appsettings.user.json` находится в папке `ComplexBot/`
2. Проверьте синтаксис JSON (скобки, запятые)
3. Используйте "Reset to Defaults" и настройте заново

**Q: Можно ли иметь несколько профилей настроек?**
A: Сейчас нет, но можно вручную переименовывать файлы:
```
appsettings.user.json → appsettings.user.conservative.json
appsettings.user.json → appsettings.user.aggressive.json
```
И копировать нужный как `appsettings.user.json` перед запуском.

---

## Пример: Полная настройка для новичка

**Шаг 1**: Первый запуск

```bash
cd ComplexBot
dotnet run
```

**Шаг 2**: Настройка API (для бумажной торговли)

```
Select mode:
> Configuration Settings

Which settings to configure?
> API Keys

Binance API Configuration
API Key: [ваш testnet key]
API Secret: ******
Use Testnet? [y/n]: y

✓ Configuration saved
```

**Шаг 3**: Настройка Telegram (опционально)

```
Which settings to configure?
> Telegram Notifications

Enable Telegram notifications? y
Bot Token: 7123456789:AAH...
Chat ID: 987654321

✓ Configuration saved
```

**Шаг 4**: Проверка настроек риска (опционально)

```
Which settings to configure?
> Risk Management

[Нажимайте Enter для каждого параметра = используются дефолты]

Save these settings? y
```

**Шаг 5**: Запуск Paper Trading

```
Select mode:
> Live Trading (Paper)

Using Testnet API keys from configuration  ← Автоматически!
✓ Telegram notifications enabled (from config)  ← Автоматически!

Symbol [BTCUSDT]: [Enter]
Interval: 4h
...

Starting trader... ✅
```

**Готово!** Все настройки сохранены. При следующем запуске всё загрузится автоматически.

---

# Часть 5: Режимы работы бота

## Обзор режимов

```
┌─────────────────────────────────────────────────────────────────┐
│                        РЕЖИМЫ РАБОТЫ                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────┐  Настройка API ключей и параметров         │
│  │  Configuration  │  "Сохранить настройки один раз"            │
│  └─────────────────┘                                             │
│         ↓                                                        │
│  ┌─────────────┐  Тестирование на прошлых данных                │
│  │  Backtest   │  "Что было бы, если бы робот торговал раньше?" │
│  └─────────────┘                                                 │
│         ↓                                                        │
│  ┌─────────────┐  Поиск лучших настроек                         │
│  │ Optimization│  "Какие параметры работают лучше всего?"       │
│  └─────────────┘                                                 │
│         ↓                                                        │
│  ┌─────────────┐  Проверка надёжности                           │
│  │Walk-Forward │  "Стратегия работает или это случайность?"     │
│  └─────────────┘                                                 │
│         ↓                                                        │
│  ┌─────────────┐  Анализ рисков                                 │
│  │ Monte Carlo │  "Какой худший сценарий возможен?"             │
│  └─────────────┘                                                 │
│         ↓                                                        │
│  ┌─────────────┐  Торговля без реальных денег                   │
│  │Paper Trading│  "Потренироваться без риска"                   │
│  └─────────────┘                                                 │
│         ↓                                                        │
│  ┌─────────────┐  Реальная торговля                             │
│  │ Live Trading│  "Торговать настоящими деньгами"               │
│  └─────────────┘                                                 │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## Режим 1: Backtest (Тестирование на истории)

### Что это?

Backtest позволяет проверить, как бы работала стратегия в прошлом.

```
Пример:
- Берём данные Bitcoin за 2023 год
- "Прогоняем" через робота
- Смотрим: заработал бы робот или нет?
```

### Как использовать?

1. Выберите "Backtest" в меню
2. Выберите источник данных:
   - **Download from Binance** — скачать свежие данные
   - **Load from CSV file** — использовать сохранённые данные

3. Укажите параметры:
   ```
   Symbol: BTCUSDT          ← Какую пару тестировать
   Interval: 4h             ← Таймфрейм (рекомендуется 4h)
   History months: 12       ← Сколько месяцев данных
   ```

4. Настройте риск-менеджмент:
   ```
   Risk per trade (%): 1.5        ← Риск на сделку
   Max portfolio heat (%): 15     ← Максимальный общий риск
   Max drawdown (%): 20           ← Остановка при общей просадке
   Max daily drawdown (%): 3      ← Дневной лимит потерь (новое!)
   ATR stop multiplier: 2.5       ← Размер стоп-лосса
   Take profit ratio: 1.5         ← Соотношение прибыль/риск
   ```

5. Используйте настройки по умолчанию для стратегии (нажмите Y)

6. Дождитесь результатов

### Пример результатов:

```
═══════════════════════ Backtest Results ═══════════════════════

┌────────────────────┬─────────────┐
│ Metric             │ Value       │
├────────────────────┼─────────────┤
│ Strategy           │ ADX Trend   │
│ Period             │ 2023-01-01 → 2023-12-31 │
│ Initial Capital    │ $10,000.00  │
│ Final Capital      │ $12,847.50  │  ← Сколько стало
│ Total Return       │ +28.47%     │  ← Общая прибыль
│ Annualized Return  │ +28.47%     │  ← Годовая доходность
├────────────────────┼─────────────┤
│ Risk Metrics       │             │
│ Max Drawdown       │ -12.34%     │  ← Максимальная просадка
│ Sharpe Ratio       │ 1.67        │  ← Доходность/риск (>1 хорошо)
│ Sortino Ratio      │ 2.14        │
│ Profit Factor      │ 1.85        │  ← Прибыль/убыток (>1.5 хорошо)
├────────────────────┼─────────────┤
│ Trade Statistics   │             │
│ Total Trades       │ 47          │  ← Количество сделок
│ Win Rate           │ 48.9%       │  ← Процент прибыльных
│ Winning/Losing     │ 23 / 24     │
│ Average Win        │ +$287.50    │  ← Средняя прибыль
│ Average Loss       │ -$142.30    │  ← Средний убыток
│ Largest Win        │ +$892.00    │
│ Largest Loss       │ -$312.00    │
│ Avg Holding        │ 2.3 days    │  ← Среднее время в сделке
└────────────────────┴─────────────┘
```

### Экспорт журнала сделок в CSV

После завершения бэктеста робот предложит экспортировать **детальный журнал всех сделок** в CSV файл.

```
Export trade journal to CSV? [y/n] (default = y): y

📊 Trade journal exported: trades/trades_20260102_143022.csv

Trade Journal Statistics:
  Total Trades: 47
  Win Rate: 48.9%
  Average R-Multiple: 0.73
  Total Net P&L: $2,847.50
  Average Win: $287.50
  Average Loss: -$142.30
  Largest Win: $892.00
  Largest Loss: -$312.00
  Average Bars in Trade: 18.5
```

#### Что содержит CSV файл?

Журнал сохраняет **все детали каждой сделки**:

```
┌─────────────────────────────────────────────────────────────┐
│              СОДЕРЖАНИЕ TRADE JOURNAL CSV                    │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  БАЗОВАЯ ИНФОРМАЦИЯ:                                         │
│  • TradeId — номер сделки                                   │
│  • EntryTime, ExitTime — время входа/выхода                 │
│  • Symbol — торговая пара (BTCUSDT)                         │
│  • Direction — направление (Buy/Sell)                       │
│                                                              │
│  ЦЕНЫ И ПОЗИЦИЯ:                                            │
│  • EntryPrice, ExitPrice — цены входа/выхода                │
│  • StopLoss, TakeProfit — уровни защиты                     │
│  • Quantity — размер позиции                                │
│  • PositionValue — стоимость позиции в USD                  │
│  • RiskAmount — сколько рисковали                           │
│                                                              │
│  РЕЗУЛЬТАТЫ:                                                 │
│  • GrossPnL — прибыль/убыток                                │
│  • NetPnL — прибыль после комиссий                          │
│  • RMultiple — кратность риска (важно!)                     │
│  • Result — Win/Loss/Breakeven                              │
│                                                              │
│  ИНДИКАТОРЫ НА МОМЕНТ ВХОДА:                                │
│  • ADX, +DI, -DI — сила и направление тренда               │
│  • FastEMA, SlowEMA — скользящие средние                    │
│  • ATR — волатильность                                      │
│  • MACD_Hist — гистограмма MACD                             │
│  • VolumeRatio — отношение объёма к среднему                │
│  • OBV_Slope — наклон On-Balance Volume                     │
│                                                              │
│  ПРИЧИНЫ И МЕТРИКИ:                                         │
│  • EntryReason — почему вошли (текст)                       │
│  • ExitReason — почему вышли (текст)                        │
│  • BarsInTrade — сколько свечей держали                     │
│  • Duration — время в сделке (часы)                         │
│  • MAE — Maximum Adverse Excursion (худшая точка)           │
│  • MFE — Maximum Favorable Excursion (лучшая точка)         │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

#### Как использовать журнал для анализа?

**1. Анализ R-Multiple (кратность риска)**

R-Multiple показывает, насколько хорошо работает ваш риск-менеджмент:

```
R-Multiple = NetPnL / RiskAmount

Примеры:
+2.0R  = Прибыль в 2 раза больше риска ✅✅
+1.0R  = Прибыль равна риску ✅
+0.5R  = Прибыль в половину от риска ⚠️
-1.0R  = Убыток = размеру стоп-лосса (нормально)
-0.5R  = Закрыли до стоп-лосса (возможно, правильно)

Хорошая стратегия: средний R-Multiple > 0.5
```

**2. Анализ MAE/MFE**

```
MAE (Maximum Adverse Excursion):
"Насколько сильно цена шла против вас?"

Если MAE часто близко к стоп-лоссу:
→ Стоп-лосс установлен правильно ✅

Если MAE намного меньше стоп-лосса:
→ Можно сузить стоп и улучшить R:R ⚠️

MFE (Maximum Favorable Excursion):
"Насколько высоко цена доходила в прибыль?"

Если MFE намного больше тейк-профита:
→ Можно поднять тейк-профит 💡

Если часто выходите до тейк-профита:
→ Тренд слаб или стратегия выхода неоптимальна ⚠️
```

**3. Анализ причин входа/выхода**

Откройте CSV в Excel/Google Sheets и:

```
• Фильтруйте по Result = "Win":
  Какие EntryReason чаще приводят к прибыли?

• Фильтруйте по Result = "Loss":
  Какие условия входа дают убытки?

• Сортируйте по RMultiple:
  Какие сделки дали +3R и выше?
  Что у них общего?

• Анализируйте ExitReason:
  Как часто срабатывает стоп vs тейк-профит?
  Правильно ли установлены уровни?
```

**4. Анализ индикаторов**

```
Постройте графики в Excel:

ADX vs RMultiple:
  При каких значениях ADX сделки успешнее?

VolumeRatio vs Result:
  Подтверждается ли, что высокий объём = лучше?

BarsInTrade vs NetPnL:
  Длинные сделки прибыльнее коротких?
```

#### Пример анализа в Excel

```
1. Откройте CSV файл в Excel
2. Добавьте сводную таблицу (PivotTable):
   - Строки: Result (Win/Loss/Breakeven)
   - Значения: Count of TradeId, Average of RMultiple

3. Создайте графики:
   - Scatter: ADX (X) vs RMultiple (Y)
   - Histogram: распределение RMultiple
   - Line: Equity curve (кумулятивная сумма NetPnL)
```

#### Зачем нужен журнал сделок?

```
✅ Понять сильные и слабые стороны стратегии
✅ Найти условия, при которых стратегия работает лучше
✅ Выявить ошибки в риск-менеджменте
✅ Оптимизировать точки входа и выхода
✅ Вести статистику для налогов
✅ Обучаться на собственном опыте
```

**Рекомендация**: Экспортируйте журнал после **каждого** бэктеста и анализируйте. Это ключ к улучшению результатов!

---

## Режим 2: Parameter Optimization (Поиск лучших настроек)

### Что это?

Робот перебирает разные комбинации настроек и находит лучшие.

```
Пример перебора:
- ADX период: 10, 14, 20
- EMA быстрая: 10, 15, 20, 25
- EMA медленная: 40, 50, 60, 80
- ... и так далее

Всего комбинаций: 3 × 4 × 4 × ... = сотни вариантов
```

### Как использовать?

1. Выберите "Parameter Optimization"
2. Загрузите данные
3. Выберите цель оптимизации:
   - **RiskAdjusted** — баланс прибыли и риска (рекомендуется)
   - **SharpeRatio** — доходность с учётом риска
   - **TotalReturn** — максимальная прибыль

4. Используйте диапазоны по умолчанию (Y) или настройте свои

### Пример результатов:

```
═══════════════════ Optimization Results ═══════════════════

┌────────────────────┬─────────────┐
│ Total combinations │ 576         │
│ Valid combinations │ 412         │
│ Robust Results     │ 23          │  ← Надёжные настройки
└────────────────────┴─────────────┘

═══════════════════ Top 10 Parameter Sets ═══════════════════

┌───┬─────┬───────────┬───────────┬──────┬──────┬───────────┐
│ # │ ADX │ Threshold │ Fast/Slow │ ATR× │ Vol× │ OOS Sharpe│
├───┼─────┼───────────┼───────────┼──────┼──────┼───────────┤
│ 1 │ 14  │ 25        │ 20/50     │ 2.5  │ 1.5  │ 1.72  ✓   │
│ 2 │ 14  │ 25        │ 15/50     │ 2.5  │ 1.5  │ 1.65  ✓   │
│ 3 │ 10  │ 25        │ 20/50     │ 2.0  │ 1.5  │ 1.58  ✓   │
└───┴─────┴───────────┴───────────┴──────┴──────┴───────────┘

✓ = Robust (работает и на тестовых, и на проверочных данных)
```

**Важно**: Выбирайте настройки с пометкой "Robust" — они более надёжные.

---

## Режим 3: Walk-Forward Analysis (Проверка надёжности)

### Что это?

Это продвинутый способ проверить, что стратегия работает не случайно.

```
Идея:
1. Берём данные за год
2. Делим на части: 70% для обучения, 30% для проверки
3. "Обучаем" на первой части
4. "Проверяем" на второй части
5. Если результаты похожи — стратегия надёжная
```

```
┌───────────────────────────────────────────────────────────┐
│                    WALK-FORWARD АНАЛИЗ                     │
├───────────────────────────────────────────────────────────┤
│                                                            │
│ Период 1:                                                  │
│ [====== In-Sample 70% ======][== OOS 30% ==]              │
│ (оптимизация)                (проверка)                    │
│                                                            │
│ Период 2:                                                  │
│     [====== In-Sample 70% ======][== OOS 30% ==]          │
│                                                            │
│ Период 3:                                                  │
│         [====== In-Sample 70% ======][== OOS 30% ==]      │
│                                                            │
│ Если OOS результаты >= 50% от In-Sample = стратегия ОК    │
│                                                            │
└───────────────────────────────────────────────────────────┘
```

### Что смотреть в результатах?

```
┌────────────────────┬─────────────┐
│ Walk-Forward Efficiency │ 67.3%  │  ← >50% = хорошо
│ OOS Consistency    │ 83.3%       │  ← >80% = отлично
│ Strategy Robust?   │ YES         │  ← Главный показатель!
└────────────────────┴─────────────┘
```

---

## Режим 4: Monte Carlo Simulation (Симуляция рисков)

### Что это?

Monte Carlo показывает, что может случиться в будущем.

```
Идея:
1. Берём результаты бэктеста (список сделок)
2. Перемешиваем их случайным образом 1000 раз
3. Смотрим: какой результат в худшем случае?
```

```
Оригинальные сделки:
[+$100] [+$200] [-$50] [+$150] [-$100] [+$300] [-$75]

Перемешивание 1:
[-$50] [+$300] [-$100] [+$100] [+$150] [-$75] [+$200]

Перемешивание 2:
[+$150] [-$75] [+$200] [-$50] [+$300] [+$100] [-$100]

... повторить 1000 раз ...

Результат: распределение возможных исходов
```

### Что смотреть в результатах?

```
┌────────────────────────┬─────────────┐
│ Original Return        │ +28.47%     │  ← Что было в бэктесте
│ Median Return          │ +26.12%     │  ← Типичный результат
│ 5th Percentile Return  │ +12.34%     │  ← Худшие 5% случаев
│ 95th Percentile Return │ +41.56%     │  ← Лучшие 5% случаев
│ 95th Percentile DD     │ -18.23%     │  ← Худшая просадка
│ Ruin Probability       │ 0.3%        │  ← Шанс потерять 50%+
└────────────────────────┴─────────────┘

Ruin Probability (вероятность разорения):
  < 1%  = Отлично ✅
  1-5%  = Приемлемо ⚠️
  > 5%  = Опасно ❌
```

---

## Режим 5: Live Trading — Paper (Торговля без денег)

### Что это?

Paper Trading — это симуляция реальной торговли без использования настоящих денег.

```
┌─────────────────────────────────────────────────┐
│              PAPER TRADING                       │
├─────────────────────────────────────────────────┤
│                                                  │
│  Реальные данные    ← Робот получает настоящие  │
│  с биржи              цены в реальном времени   │
│         ↓                                        │
│  Виртуальные        ← Но сделки не настоящие    │
│  сделки                                          │
│         ↓                                        │
│  Виртуальный        ← Считаем прибыль/убыток    │
│  результат            как будто торгуем         │
│                                                  │
│  РИСК: $0           ← Потерять деньги нельзя    │
│                                                  │
└─────────────────────────────────────────────────┘
```

### Как использовать?

1. Выберите "Live Trading (Paper)"
2. Выберите "Use Binance Testnet?" — **Yes**
3. Введите API ключи тестовой сети (см. ниже как получить)
4. Настройте параметры
5. Нажмите Enter и наблюдайте

### Как получить тестовые API ключи?

1. Откройте https://testnet.binance.vision/
2. Войдите через GitHub аккаунт
3. Нажмите "Generate HMAC_SHA256 Key"
4. Скопируйте API Key и Secret Key

```
⚠️ ВАЖНО: Это тестовые ключи для тестовой сети!
Они НЕ дают доступа к реальным деньгам.
```

### Что вы увидите:

```
═══ PAPER TRADING MODE ═══

Starting trader... Press Ctrl+C to stop

┌──────────┬────────┬──────────┬─────────────────────────────┐
│ Time     │ Signal │ Price    │ Reason                      │
├──────────┼────────┼──────────┼─────────────────────────────┤
│ 14:23:45 │ Buy    │ 45123.50 │ ADX>25, EMA cross, Vol 1.8x │
│ 18:45:12 │ Exit   │ 46891.25 │ Take profit reached         │
│ 22:15:33 │ Buy    │ 46234.00 │ ADX>25, EMA cross, Vol 1.6x │
└──────────┴────────┴──────────┴─────────────────────────────┘
```

---

## Режим 6: Live Trading — Real (Реальная торговля)

### ⚠️ ПРЕДУПРЕЖДЕНИЕ

```
╔═══════════════════════════════════════════════════════════════╗
║                    ⚠️  ВНИМАНИЕ  ⚠️                            ║
╠═══════════════════════════════════════════════════════════════╣
║                                                                ║
║  Этот режим использует НАСТОЯЩИЕ ДЕНЬГИ!                      ║
║                                                                ║
║  Вы можете ПОТЕРЯТЬ часть или ВСЕ свои деньги.                ║
║                                                                ║
║  Перед использованием:                                         ║
║  ✓ Протестируйте стратегию в Backtest                         ║
║  ✓ Проверьте надёжность в Walk-Forward                        ║
║  ✓ Оцените риски в Monte Carlo                                ║
║  ✓ Поторгуйте минимум 2 недели в Paper Trading                ║
║  ✓ Начните с минимальной суммы ($100-500)                     ║
║                                                                ║
║  Никогда не инвестируйте больше, чем готовы потерять!         ║
║                                                                ║
╚═══════════════════════════════════════════════════════════════╝
```

### Как получить реальные API ключи Binance?

1. Зарегистрируйтесь на https://www.binance.com/
2. Пройдите верификацию (KYC)
3. Перейдите в Профиль → API Management
4. Создайте новый API ключ
5. **ВАЖНЫЕ НАСТРОЙКИ**:
   ```
   ✅ Enable Reading        — обязательно
   ✅ Enable Spot Trading   — обязательно
   ❌ Enable Withdrawals    — НЕ включать!
   ✅ Restrict to IP        — рекомендуется (ваш IP)
   ```

```
⚠️ БЕЗОПАСНОСТЬ API КЛЮЧЕЙ:

1. Никому не показывайте Secret Key
2. Не сохраняйте ключи в коде или на GitHub
3. Ограничьте ключи по IP-адресу
4. Не давайте права на вывод средств
5. Создайте отдельный аккаунт для бота
```

### OCO Ордера (One-Cancels-Other) — Защита на стороне биржи

**Новая функция!** Робот автоматически использует **OCO ордера** для защиты позиций.

#### Что такое OCO?

OCO (One-Cancels-Other) — это комбинированный ордер, который выставляет **одновременно**:
- **Take Profit** (лимитный ордер) — для фиксации прибыли
- **Stop Loss** (стоп-лимитный ордер) — для ограничения убытков

```
┌─────────────────────────────────────────────────────────┐
│                   КАК РАБОТАЕТ OCO                       │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  1. Робот открывает позицию маркет-ордером              │
│     → Куплено 0.1 BTC по $45,000                        │
│                                                          │
│  2. Сразу выставляется OCO на бирже:                    │
│     ✅ Take Profit: $47,250 (лимит)                     │
│     🛑 Stop Loss: $43,500 (стоп-лимит)                  │
│                                                          │
│  3. Биржа следит за ценой 24/7:                         │
│                                                          │
│     Если цена достигает $47,250:                        │
│     → Take Profit исполняется                           │
│     → Stop Loss автоматически отменяется                │
│                                                          │
│     Если цена падает до $43,500:                        │
│     → Stop Loss исполняется                             │
│     → Take Profit автоматически отменяется              │
│                                                          │
│  4. Один ордер ОТМЕНЯЕТ другой (One-Cancels-Other)     │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

#### Зачем это нужно?

**Проблема без OCO:**
```
Программный стоп-лосс:
  Робот запущен на вашем компьютере
       ↓
  Интернет отключился / компьютер завис
       ↓
  Стоп-лосс НЕ сработает!
       ↓
  Позиция осталась БЕЗ ЗАЩИТЫ
       ↓
  Цена падает… падает… катастрофа! 💥
```

**Решение с OCO:**
```
Биржевой стоп-лосс (OCO):
  Ордер выставлен НА БИРЖЕ
       ↓
  Робот может отключиться — неважно!
       ↓
  Биржа ГАРАНТИРОВАННО исполнит стоп
       ↓
  Позиция ЗАЩИЩЕНА даже если вы офлайн ✅
```

#### Как это выглядит в роботе?

При открытии позиции в **реальной торговле** (не paper):

```
[12:34:56] Opened Long 0.10000 @ 45123.50, SL: 43500.00, TP: 47250.00
[12:34:57] ✅ OCO Order placed:
[12:34:57]    Take Profit: 47250.00
[12:34:57]    Stop Loss: 43500.00 (limit: 43282.50)
[12:34:57]    Order List ID: 123456789
```

**Stop Loss Limit Price**: Робот ставит лимитную цену на 0.5% ниже стопа (для лонга) или выше (для шорта), чтобы минимизировать риск проскальзывания.

#### Trailing Stop с OCO

Когда робот обновляет trailing stop:

```
Цена выросла с $45,000 до $50,000
Робот переносит стоп с $43,500 на $48,500

[14:22:11] ✅ OCO Order cancelled (ID: 123456789)
[14:22:12] ✅ OCO Order placed:
[14:22:12]    Take Profit: 47250.00
[14:22:12]    Stop Loss: 48500.00 (limit: 48257.50)
[14:22:12]    Order List ID: 987654321
[14:22:13] 🔄 Trailing stop updated to 48500.00
```

Робот **отменяет** старый OCO и **создаёт новый** с обновлённым стоп-лоссом.

#### Важные особенности OCO

```
✅ Работает только в РЕАЛЬНОЙ торговле
   → В Paper Trading OCO не создаётся (только логируется)

✅ Требуется Take Profit
   → Если стратегия не задаёт TP, OCO не выставляется

✅ Автоматическое управление
   → При закрытии позиции OCO отменяется
   → При частичном закрытии OCO пересоздаётся

✅ Защита 24/7
   → Работает даже если робот выключен
   → Работает даже если отключился интернет
```

#### Проверка OCO на бирже

Чтобы убедиться, что OCO выставлен:

1. Зайдите на Binance → **Spot → Open Orders**
2. Вы увидите **два** ордера (TP и SL) с одинаковым **Order List ID**
3. Один из них помечен как **OCO**

#### Ограничения OCO на Binance

```
⚠️ Минимальная сумма ордера: 10 USDT
⚠️ Цены должны соответствовать фильтрам символа
⚠️ Stop Limit Price должен быть близко к Stop Price
⚠️ Работает только на Spot (не Futures в текущей реализации)
```

#### FAQ по OCO

**Q: Что если биржа упадёт?**
A: OCO ордер сохранится. Когда биржа восстановится, ордер продолжит работать.

**Q: Могу ли я вручную отменить OCO?**
A: Да, но робот может выставить новый. Лучше остановить робота сначала.

**Q: OCO работает в Paper Trading?**
A: Нет, только логируется. Paper Trading симулирует всё локально.

**Q: Что если я хочу изменить стоп вручную?**
A: Используйте интерфейс Binance, но помните — робот может переставить его при следующем обновлении.

---

### Telegram Уведомления — Будьте в курсе 24/7

**Новая функция!** Робот может отправлять уведомления о важных событиях в Telegram.

#### Что такое Telegram уведомления?

Робот отправляет сообщения в ваш Telegram, когда происходят важные события:
- 🟢 Открытие новой сделки
- ✅ Закрытие сделки с прибылью
- ❌ Закрытие сделки с убытком
- ⚠️ Предупреждения о просадке
- 🚨 Срабатывание circuit breaker

```
┌─────────────────────────────────────────────────────┐
│            ЗАЧЕМ НУЖНЫ УВЕДОМЛЕНИЯ?                  │
├─────────────────────────────────────────────────────┤
│                                                      │
│  ✅ Мониторинг 24/7 без постоянного просмотра экрана│
│  ✅ Мгновенные уведомления о сделках на телефон     │
│  ✅ Контроль рисков в реальном времени              │
│  ✅ История всех событий в одном чате               │
│  ✅ Возможность быстрой реакции на проблемы         │
│                                                      │
└─────────────────────────────────────────────────────┘
```

#### Как настроить Telegram уведомления?

**Шаг 1: Создать Telegram бота**

1. Откройте Telegram и найдите **@BotFather**
2. Отправьте команду `/newbot`
3. Введите имя для бота (например: "My Trading Bot")
4. Введите username (например: "mytradingbot123_bot")
5. BotFather отправит вам **Bot Token** — скопируйте его!

```
Пример Bot Token:
7123456789:AAHdqTcvCH1vGWJxfSeofSAs0K5PALDsaw
         ↑
Сохраните это значение!
```

**Шаг 2: Получить Chat ID**

Есть два способа:

**Способ 1 (простой):**
1. Найдите бота **@userinfobot** в Telegram
2. Отправьте ему `/start`
3. Он отправит ваш **Chat ID**

**Способ 2 (через API):**
1. Напишите вашему боту (которого создали) `/start`
2. Откройте в браузере:
   ```
   https://api.telegram.org/bot<ВАШ_TOKEN>/getUpdates
   ```
   Замените `<ВАШ_TOKEN>` на token из Шага 1
3. Найдите в ответе `"id":` — это ваш **Chat ID**

```json
{
  "update_id": 123456789,
  "message": {
    "chat": {
      "id": 987654321,  ← Это ваш Chat ID!
      "first_name": "Alexandr",
      "type": "private"
    }
  }
}
```

**Шаг 3: Включить уведомления при запуске**

При запуске Live Trading робот спросит:

```
Enable Telegram notifications? [y/n] (default = n): y

Telegram Configuration:
Get bot token from @BotFather
Get chat ID from https://api.telegram.org/bot<TOKEN>/getUpdates

Bot Token: 7123456789:AAHdqTcvCH1vGWJxfSeofSAs0K5PALDsaw
Chat ID: 987654321

✓ Telegram notifications enabled
```

#### Примеры уведомлений

**1. Открытие сделки:**
```
🟢 NEW TRADE OPENED

BTCUSDT LONG

📍 Entry: 45123.50
🛑 Stop Loss: 43500.00
🎯 Take Profit: 47250.00

📊 Size: 0.1000
💰 Risk: $150.00

📝 ADX>25, EMA cross, Vol 1.8x
```

**2. Закрытие с прибылью:**
```
✅ TRADE CLOSED

BTCUSDT

📍 Entry: 45123.50
📍 Exit: 46891.25

📈 PnL: $176.77 (1.18R)

📝 Take profit reached
```

**3. Закрытие с убытком:**
```
❌ TRADE CLOSED

BTCUSDT

📍 Entry: 45123.50
📍 Exit: 43500.00

📉 PnL: -$150.00 (-1.00R)

📝 Stop Loss
```

**4. Предупреждение о просадке:**
```
⚠️ DRAWDOWN ALERT

📉 Total Drawdown: 12.5%
📉 Daily Drawdown: 2.8%

Risk management may reduce position sizes
```

**5. Circuit Breaker:**
```
🚨 CIRCUIT BREAKER TRIGGERED

⛔ Trading has been stopped!

Reason: Max drawdown exceeded: 20.00%

Manual intervention required
```

#### Безопасность Telegram

```
⚠️ ВАЖНАЯ ИНФОРМАЦИЯ О БЕЗОПАСНОСТИ:

1. ❌ НИКОГДА не делитесь Bot Token
   → Это как пароль от бота

2. ❌ НЕ публикуйте Chat ID в интернете
   → Кто-то может отправлять вам спам

3. ✅ Используйте бота только для себя
   → Не добавляйте незнакомых в группу с ботом

4. ✅ Если token утек — создайте нового бота
   → @BotFather → /revoke → выберите бота

5. ✅ Храните данные в безопасном месте
   → Используйте менеджер паролей
```

#### FAQ по Telegram

**Q: Уведомления не приходят, что делать?**
A: Проверьте:
1. Написали ли вы боту `/start` перед использованием
2. Правильно ли скопировали Bot Token и Chat ID (без пробелов)
3. Не заблокирован ли бот (зайдите в чат с ботом)
4. Проверьте логи робота — есть ли ошибки "Telegram error"

**Q: Можно ли отправлять уведомления в группу?**
A: Да! Создайте группу, добавьте бота, сделайте его админом. Chat ID группы будет отрицательным (например: -1001234567890).

**Q: Сколько стоят уведомления?**
A: Telegram Bot API полностью бесплатный. Нет лимитов на количество сообщений.

**Q: Можно ли настроить, какие уведомления получать?**
A: В текущей версии отправляются все события. Кастомизация будет добавлена в будущих версиях.

**Q: Работают ли уведомления в Paper Trading?**
A: Да! Уведомления работают и в реальной, и в бумажной торговле.

**Q: Можно ли отключить уведомления после запуска?**
A: Нужно перезапустить робота и выбрать "No" на вопрос о Telegram.

#### Полезные команды для бота

Вы можете добавить команды для управления ботом (в будущих версиях):

```
/status  — текущий статус (equity, позиции, просадка)
/summary — дневная сводка
/stop    — остановить торговлю
/resume  — возобновить торговлю
```

---

### Умный вход с лимитными ордерами (Smart Entry)

Начиная с версии 1.7, бот использует **умную стратегию входа в позицию**, которая пытается получить лучшую цену через лимитные ордера.

#### Как это работает?

1. **Попытка лимитного ордера** (приоритет):
   - Бот размещает лимитный ордер на 0.05% лучше текущей рыночной цены
   - Для покупки: цена на 0.05% ниже рынка
   - Для продажи: цена на 0.05% выше рынка
   - Ожидание исполнения: 3 секунды

2. **Fallback на рыночный ордер**:
   - Если лимитный ордер не исполнился за 3 секунды
   - Автоматическая отмена лимитного ордера
   - Немедленное размещение рыночного ордера
   - Гарантирует, что позиция будет открыта

#### Пример успешного лимитного ордера

```
[15:23:45] 📊 ADX Trend Following: BUY signal
[15:23:45] Position size: 0.05000 BTC, Risk: $150.00, Stop: $29,500
[15:23:45] Attempting limit order @ 29,985.00 (market: 30,000.00)
[15:23:46] Limit order placed: ID=12345678, Price=29,985.00
[15:23:47] ✅ Limit order filled: 0.05000 @ 29,985.00
[15:23:47] 💰 Limit order saved $0.75 vs market price
[15:23:47] ✅ Excellent execution (no slippage)
[15:23:47] ✅ Position opened: LONG 0.05000 BTC @ $29,985.00
```

#### Пример таймаута и fallback

```
[15:25:12] 📊 ADX Trend Following: BUY signal
[15:25:12] Attempting limit order @ 30,485.00 (market: 30,500.00)
[15:25:12] Limit order placed: ID=12345679, Price=30,485.00
[15:25:15] ⏱️ Limit order timeout, cancelling...
[15:25:15] Limit order failed, using market order...
[15:25:16] Market order filled: 0.05000 @ 30,502.50
[15:25:16] ⚠️ Slippage: 0.008% (worse than expected)
[15:25:16] ✅ Position opened: LONG 0.05000 BTC @ $30,502.50
```

#### Преимущества

- **Экономия на комиссиях**: Лимитные ордера часто дают maker rebate вместо taker fee
- **Лучшие цены**: Экономия 0.05% на каждой сделке при успешном лимите
- **Защита от проскальзывания**: Автоматическая валидация slippage
- **Надёжность**: Гарантированный вход через fallback на рыночный ордер

#### Валидация исполнения ордеров

Бот автоматически проверяет качество исполнения каждого ордера:

- **Отличное исполнение** ✅: Проскальзывание < 0.01%
- **Хорошее исполнение** ⚠️: Проскальзывание < 0.1%
- **Допустимое исполнение** ⚠️: Проскальзывание < 0.5%
- **Плохое исполнение** ❌: Проскальзывание > 0.5% (логируется предупреждение)

Все данные о проскальзывании записываются в лог для последующего анализа эффективности исполнения.

---

### Реалтайм отслеживание капитала (Equity Tracking)

**Новая функция!** Бот отслеживает ваш капитал в реальном времени с учётом **открытых позиций**.

#### Что это такое?

Традиционно многие боты обновляют капитал только при **закрытии** сделки. Это создаёт проблему:

```
❌ ПРОБЛЕМА БЕЗ РЕАЛТАЙМ TRACKING:

Капитал на начало дня: $10,000
Открыта позиция: Купили BTC по $50,000

Цена упала до $45,000
→ Нереализованный убыток: -$500
→ НО бот думает, что капитал всё ещё $10,000
→ Может открыть ещё одну позицию с риском $150
→ Общий риск становится СЛИШКОМ ВЫСОКИМ!
```

**Решение с реалтайм tracking:**

```
✅ С РЕАЛТАЙМ TRACKING:

Капитал на начало дня: $10,000
Открыта позиция: Купили BTC по $50,000

Цена упала до $45,000
→ Нереализованный убыток: -$500
→ Текущий капитал = $10,000 - $500 = $9,500 ✅
→ Бот ВИДИТ реальную ситуацию
→ Может принять правильное решение о новых сделках
```

#### Как это работает?

Бот постоянно отслеживает:

1. **Реализованный капитал** — деньги на счёте после закрытых сделок
2. **Нереализованная прибыль/убыток** — плавающий P&L по открытым позициям
3. **Общий капитал** = Реализованный + Нереализованный

```
┌─────────────────────────────────────────────────────┐
│              РЕАЛТАЙМ EQUITY TRACKING                │
├─────────────────────────────────────────────────────┤
│                                                      │
│  Каждая новая свеча (каждые 4 часа):               │
│                                                      │
│  1️⃣ Обновить текущую цену позиции                   │
│     BTC: $50,000 → $49,500                          │
│                                                      │
│  2️⃣ Пересчитать нереализованный P&L                 │
│     Unrealized = ($49,500 - $50,000) × 0.1 BTC      │
│                = -$50                               │
│                                                      │
│  3️⃣ Обновить общий капитал                          │
│     Total Equity = $10,000 + (-$50) = $9,950       │
│                                                      │
│  4️⃣ Проверить лимиты с учётом unrealized            │
│     - Дневная просадка: ($10,000 - $9,950) = 0.5%  │
│     - Общая просадка: если пик был $11,000         │
│       → ($11,000 - $9,950) / $11,000 = 9.5%        │
│                                                      │
│  5️⃣ Решить: можно ли открывать новые позиции?       │
│                                                      │
└─────────────────────────────────────────────────────┘
```

#### Защита от превышения лимитов

Реалтайм tracking защищает вас от:

**1. Превышения дневного лимита потерь**

```
Пример:
Дневной лимит: 3%
Капитал утром: $10,000

14:00 → Открыта позиция, unrealized: -$200 (2%)
18:00 → Цена упала, unrealized: -$280 (2.8%)

❌ БЕЗ tracking: бот может открыть ещё позицию
✅ С tracking: бот ВИДИТ, что до лимита осталось 0.2%
              и может отказаться от новой сделки
```

**2. Превышения общей просадки**

```
Максимальная просадка: 20%
Пиковый капитал: $10,000
Текущий реализованный: $9,000 (просадка 10%)

Открыта позиция с unrealized: -$1,200

✅ Общая просадка = ($10,000 - ($9,000 - $1,200)) / $10,000
                  = 22% → ПРЕВЫШЕН ЛИМИТ!

→ Бот НЕ ОТКРОЕТ новые позиции
→ Может даже закрыть текущую позицию (circuit breaker)
```

**3. Каскадных убытков**

```
Сценарий:
- Позиция 1: unrealized -$300
- Позиция 2: unrealized -$450
- Суммарный unrealized: -$750

Без tracking: бот не видит проблему
С tracking: бот видит общую картину и корректирует риски
```

#### Примеры из логов

**Открытие позиции:**
```
[10:00:00] Position opened: LONG 0.1 BTC @ $50,000
[10:00:00] Current equity: $10,000.00
[10:00:00] Unrealized P&L: $0.00
```

**Обновление через 4 часа (цена упала):**
```
[14:00:00] Price updated: $49,200
[14:00:00] Unrealized P&L: -$80.00
[14:00:00] Total equity (incl. unrealized): $9,920.00
[14:00:00] Total drawdown: 0.80%
```

**Попытка открыть новую позицию:**
```
[14:00:05] 📊 ADX Trend Following: BUY signal
[14:00:05] Checking risk limits...
[14:00:05] Daily drawdown: 0.80% (limit: 3.00%) ✅
[14:00:05] Total drawdown: 0.80% (limit: 20.00%) ✅
[14:00:05] Portfolio heat: 1.5% (limit: 15.00%) ✅
[14:00:05] ✅ Can open position
```

**Срабатывание защиты:**
```
[18:00:00] Price updated: $47,500
[18:00:00] Unrealized P&L: -$250.00
[18:00:00] Total equity: $9,750.00
[18:00:00] Daily drawdown: 2.50%
[18:00:05] 📊 ADX Trend Following: BUY signal
[18:00:05] ⛔ Daily loss limit exceeded: 2.50%
[18:00:05] ❌ Cannot open new position
```

#### Преимущества

```
✅ Точный расчёт рисков
   → Учитывает ВСЕ открытые позиции

✅ Защита от перегрузки
   → Не даст открыть слишком много позиций одновременно

✅ Честный расчёт просадки
   → Вы видите РЕАЛЬНОЕ состояние капитала, не завышенное

✅ Динамическая корректировка
   → Размер позиций автоматически уменьшается при просадках

✅ Прозрачность
   → Логи показывают и реализованный, и нереализованный P&L
```

#### Технические детали

Для разработчиков:

```csharp
// RiskManager автоматически отслеживает позиции
_riskManager.AddPosition(symbol, direction, quantity, ...);

// Каждую свечу обновляется цена
_riskManager.UpdatePositionPrice(symbol, currentPrice);

// Получить unrealized P&L
decimal unrealized = _riskManager.GetUnrealizedPnL();

// Получить общий капитал
decimal totalEquity = _riskManager.GetTotalEquity();

// Проверка лимитов УЧИТЫВАЕТ unrealized
bool canOpen = _riskManager.CanOpenPosition();
```

#### FAQ

**Q: Работает ли это в backtesting?**
A: Да! BacktestEngine также использует реалтайм tracking для более точных результатов.

**Q: Влияет ли это на производительность?**
A: Нет. Расчёт очень быстрый и выполняется только при получении новой свечи.

**Q: Можно ли отключить?**
A: Нет, эта функция критически важна для безопасности. Она всегда активна.

**Q: Как часто обновляется unrealized P&L?**
A: Каждую новую свечу (например, каждые 4 часа для 4h таймфрейма).

**Q: Учитываются ли комиссии?**
A: Unrealized P&L показывает чистую прибыль без учёта комиссий на выход. Комиссии учитываются только при фактическом закрытии позиции.

---

### Минимальный баланс для торговли (Minimum Balance)

**Зачем это нужно?**

Защита от торговли с околонулевым или слишком маленьким счётом. Когда баланс становится слишком маленьким:
- Позиции становятся микроскопическими
- Комиссии съедают большую часть прибыли
- Невозможно корректно управлять рисками
- Лучше прекратить торговлю и пополнить счёт

**Как работает?**

Бот проверяет минимальный баланс перед каждой попыткой открыть позицию:

```
RiskSettings:
  MinimumEquityUsd: 100   ← По умолчанию $100
```

**Примеры работы:**

1. **Нормальная торговля:**
```
Current equity: $1,250.00
Minimum required: $100.00
✅ Can open new positions
```

2. **Баланс упал ниже минимума:**
```
⛔ Equity below minimum: $87.50 < $100.00
🚫 Trading halted - insufficient balance
📊 Please deposit funds to resume trading
```

**Что происходит при срабатывании:**

```
[12:00:00] 📊 Equity: $92.00, Peak: $1,500.00, Drawdown: 93.87%
[12:00:00] ⛔ Equity below minimum: $92.00 < $100.00
[12:00:00] 🚫 Cannot open new positions
[12:00:00] ℹ️ Existing positions will continue to be managed
[12:00:00] ℹ️ Stop-loss and take-profit orders remain active
```

**Важно:**

1. **Блокируются только НОВЫЕ позиции:**
   - Бот НЕ закрывает существующие позиции
   - Stop-loss и take-profit продолжают работать
   - Частичные выходы продолжают выполняться

2. **Минимальный баланс - это жёсткий лимит:**
   - Нельзя обойти или временно отключить
   - Это критическая защита от убыточной торговли с маленьким счётом

3. **Когда возобновится торговля:**
   - Когда вы пополните счёт выше минимума
   - ИЛИ когда закроются позиции с прибылью и баланс вырастет

**Пример сценария:**

```
Day 1: Equity = $500    ✅ Trading
Day 5: Equity = $200    ✅ Trading
Day 8: Equity = $95     ⛔ HALTED - below minimum
       ↓
       [Deposit $150]
       ↓
       Equity = $245    ✅ Trading resumed
```

**Настройка минимального баланса:**

Вы можете изменить минимум в коде:

```csharp
var riskSettings = new RiskSettings
{
    MinimumEquityUsd = 100m  // Измените это значение
    // Рекомендации:
    // - $50-100 для тестирования
    // - $500-1000 для реальной торговли
    // - Минимум должен покрывать хотя бы 10 сделок
};
```

**Формула для расчёта минимума:**

```
Минимальный баланс >= (1 / RiskPerTrade) * 10

Примеры:
- Risk 1% per trade → минимум $1,000 (100 / 1 * 10)
- Risk 1.5% per trade → минимум $667 (100 / 1.5 * 10)
- Risk 2% per trade → минимум $500 (100 / 2 * 10)
```

**Почему именно 10 сделок?**

Это минимальное количество сделок для статистической значимости:
- Меньше 10 сделок = невозможно оценить стратегию
- С меньшим балансом вы торгуете на удачу, а не на математике

**FAQ:**

**Q: Что если я хочу торговать с $50?**
A: Измените `MinimumEquityUsd = 50m`, но помните - с таким балансом комиссии будут съедать значительную часть прибыли. Это только для тестирования.

**Q: Бот закроет мои позиции при достижении минимума?**
A: НЕТ! Бот только блокирует НОВЫЕ позиции. Существующие позиции продолжают управляться нормально.

**Q: Как возобновить торговлю после остановки?**
A: Пополните счёт выше минимального баланса. Бот автоматически возобновит торговлю при следующем сигнале.

**Q: Можно ли отключить эту проверку?**
A: Технически да (установите `MinimumEquityUsd = 0`), но это КРАЙНЕ НЕ РЕКОМЕНДУЕТСЯ. Это критическая защита.

---

### Portfolio Risk Management (Управление портфелем)

**Зачем это нужно?**

При торговле несколькими парами одновременно (multi-symbol trading) возникают дополнительные риски:
- **Корреляция**: BTC падает → ETH, BNB, SOL тоже падают → все стопы срабатывают одновременно
- **Чрезмерная концентрация**: Слишком много позиций в одной группе активов
- **Портфельный риск**: Нужно контролировать общий drawdown по всем позициям

PortfolioRiskManager решает эти проблемы на уровне всего портфеля.

**Как работает?**

```csharp
var portfolioSettings = new PortfolioRiskSettings
{
    MaxTotalDrawdownPercent = 25m,      // Макс просадка портфеля
    MaxCorrelatedRiskPercent = 10m,     // Макс риск на коррелированные активы
    MaxConcurrentPositions = 5          // Макс одновременных позиций
};

var portfolioManager = new PortfolioRiskManager(portfolioSettings);

// Регистрируем символы
portfolioManager.RegisterSymbol("BTCUSDT", btcRiskManager);
portfolioManager.RegisterSymbol("ETHUSDT", ethRiskManager);
portfolioManager.RegisterSymbol("BNBUSDT", bnbRiskManager);
```

**Группы корреляции (по умолчанию):**

```
BTC_CORRELATED:
  - BTCUSDT, ETHUSDT, BNBUSDT, SOLUSDT
  (Движутся вместе с Bitcoin)

ALTCOINS_L1:
  - ADAUSDT, DOTUSDT, AVAXUSDT, MATICUSDT
  (Layer-1 блокчейны)

ALTCOINS_DEFI:
  - UNIUSDT, AAVEUSDT, LINKUSDT, SUSHIUSDT
  (DeFi протоколы)

MEMECOINS:
  - DOGEUSDT, SHIBUSDT, PEPEUSDT
  (Мем-коины, высокая волатильность)
```

**Как это работает на практике:**

**Сценарий 1: Блокировка по корреляционному риску**

```
Текущее состояние:
  ✅ BTCUSDT: позиция открыта, риск 3%
  ✅ ETHUSDT: позиция открыта, риск 4%
  ✅ SOLUSDT: позиция открыта, риск 3.5%

  📊 Корреляционный риск группы BTC_CORRELATED: 10.5%

Попытка открыть BNBUSDT:
  ⛔ Correlated risk too high for BNBUSDT (group: BTC_CORRELATED): 10.5% >= 10.0%
  🚫 Новая позиция в этой группе ЗАБЛОКИРОВАНА

  ℹ️ Можно открыть позицию в другой группе (например, ADAUSDT)
```

**Сценарий 2: Блокировка по количеству позиций**

```
Открытые позиции:
  1. BTCUSDT (BTC_CORRELATED)
  2. ETHUSDT (BTC_CORRELATED)
  3. ADAUSDT (ALTCOINS_L1)
  4. DOTUSDT (ALTCOINS_L1)
  5. UNIUSDT (ALTCOINS_DEFI)

Попытка открыть 6-ю позицию:
  ⛔ Max concurrent positions reached: 5 >= 5
  🚫 Дождитесь закрытия одной из позиций
```

**Сценарий 3: Блокировка по общей просадке портфеля**

```
Portfolio Stats:
  Total Equity: $7,500
  Peak Equity: $10,000
  Drawdown: 25%

Попытка открыть новую позицию:
  ⛔ Portfolio drawdown exceeded: 25.00% >= 25.00%
  🚫 Портфель достиг максимальной просадки
  ℹ️ Торговля возобновится когда drawdown уменьшится
```

**Преимущества:**

1. **Защита от корреляционных обвалов:**
   - Не даст открыть 5 BTC-коррелированных позиций перед обвалом
   - Диверсификация между группами активов

2. **Контроль концентрации:**
   - Ограничивает количество одновременных позиций
   - Защита от overtrading

3. **Портфельный drawdown:**
   - Отслеживает общую просадку всех позиций
   - Останавливает торговлю при критической просадке портфеля

**Как добавить свои группы корреляции:**

```csharp
// Добавить новую группу
portfolioManager.AddCorrelationGroup("MY_FAVORITES", new[]
{
    "BTCUSDT",
    "ETHUSDT",
    "MATICUSDT"
});

// Удалить группу
portfolioManager.RemoveCorrelationGroup("MEMECOINS");

// Посмотреть все группы
var groups = portfolioManager.GetCorrelationGroups();
foreach (var group in groups)
{
    Console.WriteLine($"{group.Key}: {string.Join(", ", group.Value)}");
}
```

**Статистика портфеля:**

```csharp
var stats = portfolioManager.GetPortfolioStats();

Console.WriteLine($"Total Equity: ${stats.TotalEquity:F2}");
Console.WriteLine($"Peak Equity: ${stats.PeakEquity:F2}");
Console.WriteLine($"Drawdown: {stats.DrawdownPercent:F2}%");
Console.WriteLine($"Open Positions: {stats.OpenPositions}");

// Риск по группам
foreach (var (groupName, risk) in stats.GroupRisks)
{
    Console.WriteLine($"  {groupName}: {risk:F2}% risk");
}

// Equity по символам
foreach (var (symbol, equity) in stats.SymbolEquities)
{
    Console.WriteLine($"  {symbol}: ${equity:F2}");
}
```

**Пример вывода:**

```
Portfolio Statistics:
  Total Equity: $9,250.00
  Peak Equity: $10,000.00
  Drawdown: 7.50%
  Open Positions: 3

  Group Risks:
    BTC_CORRELATED: 7.50% risk
    ALTCOINS_L1: 3.00% risk
    ALTCOINS_DEFI: 0.00% risk
    MEMECOINS: 0.00% risk

  Symbol Equities:
    BTCUSDT: $3,100.00
    ETHUSDT: $3,050.00
    ADAUSDT: $3,100.00
```

**Настройка параметров:**

```csharp
var settings = new PortfolioRiskSettings
{
    MaxTotalDrawdownPercent = 30m,     // Консервативно: 20-25%, Агрессивно: 30-40%
    MaxCorrelatedRiskPercent = 15m,    // Консервативно: 8-10%, Агрессивно: 15-20%
    MaxConcurrentPositions = 8         // Консервативно: 3-5, Агрессивно: 8-10
};
```

**Рекомендации:**

1. **Для начинающих:**
   - MaxTotalDrawdownPercent = 20%
   - MaxCorrelatedRiskPercent = 8%
   - MaxConcurrentPositions = 3

2. **Для опытных трейдеров:**
   - MaxTotalDrawdownPercent = 25%
   - MaxCorrelatedRiskPercent = 12%
   - MaxConcurrentPositions = 5

3. **Для агрессивной торговли:**
   - MaxTotalDrawdownPercent = 30%
   - MaxCorrelatedRiskPercent = 15%
   - MaxConcurrentPositions = 8

**ВАЖНО:**

- Portfolio Risk Manager работает **поверх** обычного RiskManager
- Каждый символ всё ещё проверяет свои лимиты (drawdown, portfolio heat, daily loss)
- Portfolio Manager добавляет **дополнительный** уровень защиты на уровне портфеля

**FAQ:**

**Q: Нужно ли использовать Portfolio Manager для одного символа?**
A: Нет, для single-symbol торговли достаточно обычного RiskManager.

**Q: Что если мой символ не в группах корреляции?**
A: Он будет считаться независимым, без корреляционных ограничений.

**Q: Можно ли торговать только определённые группы?**
A: Да, просто не регистрируйте символы из нежелательных групп.

**Q: Как определить корреляцию между активами?**
A: Используйте инструменты вроде TradingView или рассчитайте correlation coefficient между ценами. Обычно активы в одном секторе коррелируют (все L1, все DeFi, все мемы).

**Q: Что если я хочу торговать 10 парами одновременно?**
A: Установите `MaxConcurrentPositions = 10`, но помните - больше позиций = сложнее управлять и выше риск.

---

### State Persistence (Сохранение состояния)

**Зачем это нужно?**

При перезапуске бота (обновление, перезагрузка сервера, crash) вся информация об открытых позициях теряется:
- 😱 Бот не знает что у вас открыта позиция
- 😱 Не может управлять стоп-лоссом
- 😱 Не знает entry price, risk amount
- 😱 OCO ордера остаются висеть на бирже, но бот о них не знает

**State Persistence решает эту проблему** - сохраняет состояние в файл и восстанавливает после перезапуска.

**Как работает?**

```csharp
var stateManager = new StateManager("bot_state.json");

// При запуске - загрузить состояние
var savedState = await stateManager.LoadState();

if (savedState != null)
{
    // Сверить с биржей
    var reconciliation = await stateManager.ReconcileWithExchange(
        binanceClient,
        savedState,
        symbol
    );

    // Восстановить позиции
    RestorePositions(savedState);
}

// При каждом изменении - сохранить
await stateManager.SaveState(BuildCurrentState());
```

**Что сохраняется:**

```json
{
  "LastUpdate": "2026-01-02T15:30:00Z",
  "CurrentEquity": 9750.50,
  "PeakEquity": 10250.00,
  "DayStartEquity": 10000.00,
  "CurrentTradingDay": "2026-01-02",
  "OpenPositions": [
    {
      "Symbol": "BTCUSDT",
      "Direction": "Buy",
      "EntryPrice": 45000.0,
      "Quantity": 0.22,
      "RemainingQuantity": 0.11,
      "StopLoss": 44500.0,
      "TakeProfit": 46500.0,
      "RiskAmount": 110.0,
      "EntryTime": "2026-01-02T14:00:00Z",
      "TradeId": 42,
      "CurrentPrice": 45250.0,
      "BreakevenMoved": true
    }
  ],
  "ActiveOcoOrders": [
    {
      "Symbol": "BTCUSDT",
      "OrderListId": 123456789
    }
  ],
  "NextTradeId": 43
}
```

**Когда происходит сохранение:**

```
✅ Позиция открыта      → SaveState()
✅ Позиция закрыта      → SaveState()
✅ Частичный выход      → SaveState()
✅ Стоп перемещён       → SaveState()
✅ OCO ордер выставлен  → SaveState()
✅ Equity обновлён      → SaveState()
```

**Восстановление после перезапуска:**

**Сценарий 1: Всё в порядке**

```
[Запуск бота]
📂 State loaded: 1 positions, Equity: $9,750.50
🔄 Reconciling state with exchange...

Checking position: BTCUSDT
  Expected quantity: 0.11
  Actual balance: 0.11 BTC
✅ Position confirmed: BTCUSDT 0.11000

Checking OCO order: #123456789
✅ OCO order active: BTCUSDT #123456789

📊 Reconciliation complete:
   Positions: 1 confirmed, 0 mismatched
   OCO Orders: 1 active, 0 missing

✅ Bot resumed successfully!
   Position: BTCUSDT Long @ 45000
   Stop Loss: 44500 (OCO active)
   Take Profit: 46500
```

**Сценарий 2: Позиция закрылась пока бот был выключен**

```
[Запуск бота]
📂 State loaded: 1 positions, Equity: $9,750.50
🔄 Reconciling state with exchange...

Checking position: BTCUSDT
  Expected quantity: 0.11
  Actual balance: 0.00 BTC
⚠️ Position mismatch: BTCUSDT
   Expected: 0.11000, Actual: 0.00000

Checking OCO order: #123456789
⚠️ OCO order not found: BTCUSDT #123456789
   This may mean the order was filled or cancelled

📊 Reconciliation complete:
   Positions: 0 confirmed, 1 mismatched
   OCO Orders: 0 active, 1 missing

⚠️ ACTION REQUIRED:
   Position was likely closed by stop-loss or take-profit
   Check your trade history on Binance
   Manually adjust equity if needed
```

**Сценарий 3: Первый запуск (нет сохранённого состояния)**

```
[Запуск бота]
📂 No saved state found, starting fresh

Bot initialized:
  Initial Equity: $10,000.00
  Open Positions: 0
  Ready to trade!
```

**Как включить State Persistence в BinanceLiveTrader:**

```csharp
public class BinanceLiveTrader
{
    private readonly StateManager _stateManager;

    public BinanceLiveTrader(...)
    {
        _stateManager = new StateManager("bot_state.json");
    }

    public async Task StartAsync()
    {
        // 1. Загрузить состояние
        var savedState = await _stateManager.LoadState();

        if (savedState != null)
        {
            // 2. Сверить с биржей
            var reconciliation = await _stateManager.ReconcileWithExchange(
                _restClient, savedState, _settings.Symbol);

            // 3. Восстановить equity
            _riskManager.UpdateEquity(savedState.CurrentEquity);

            // 4. Восстановить позицию
            if (reconciliation.PositionsConfirmed.Count > 0)
            {
                var pos = reconciliation.PositionsConfirmed[0];
                _currentPosition = pos.Direction == SignalType.Buy
                    ? pos.RemainingQuantity
                    : -pos.RemainingQuantity;
                _entryPrice = pos.EntryPrice;
                _stopLoss = pos.StopLoss;
                _takeProfit = pos.TakeProfit;

                // Восстановить в RiskManager
                _riskManager.AddPosition(
                    pos.Symbol, pos.Direction,
                    pos.RemainingQuantity, pos.RiskAmount,
                    pos.EntryPrice, pos.StopLoss, pos.CurrentPrice);

                Log($"✅ Position restored: {pos.Symbol} {pos.RemainingQuantity:F5} @ {pos.EntryPrice:F2}");
            }

            // 5. Восстановить OCO ордер ID
            if (reconciliation.OcoOrdersActive.Count > 0)
            {
                _currentOcoOrderListId = reconciliation.OcoOrdersActive[0].OrderListId;
                Log($"✅ OCO order restored: #{_currentOcoOrderListId}");
            }
        }

        // Продолжить нормальную работу...
    }

    private async Task OpenPositionAsync(...)
    {
        // ... открыть позицию ...

        // Сохранить состояние
        await SaveCurrentState();
    }

    private async Task SaveCurrentState()
    {
        var state = new StateManager.BotState
        {
            LastUpdate = DateTime.UtcNow,
            CurrentEquity = await GetAccountBalanceAsync(),
            PeakEquity = _riskManager.GetPeakEquity(),
            DayStartEquity = _riskManager.GetDayStartEquity(),
            CurrentTradingDay = DateTime.UtcNow.Date,
            OpenPositions = BuildOpenPositions(),
            ActiveOcoOrders = BuildActiveOcoOrders(),
            NextTradeId = GetNextTradeId()
        };

        await _stateManager.SaveState(state);
    }
}
```

**Преимущества:**

1. **Устойчивость к сбоям:**
   - Перезапуск сервера → позиции не потеряны
   - Обновление кода → можно продолжить без потерь
   - Crash → всё восстановится

2. **Защита капитала:**
   - Стопы продолжают работать (OCO на бирже)
   - Equity tracking не сбрасывается
   - Дневные лимиты сохраняются

3. **Аудит:**
   - История состояний в файле
   - Можно отследить что было во время crash
   - Легко восстановить вручную

**Важные моменты:**

⚠️ **State file - критически важен:**
- Делайте backup регулярно
- Не удаляйте вручную при открытых позициях
- Храните в безопасном месте

⚠️ **Reconciliation обязателен:**
- ВСЕГДА сверяйте с биржей после загрузки
- Не доверяйте слепо saved state
- Биржа - source of truth

⚠️ **OCO ордера на бирже:**
- Даже если бот упал, OCO продолжает работать
- При восстановлении бот найдёт активные OCO
- Если OCO не найден - позиция могла закрыться

**Удаление state file:**

```csharp
// Когда нет открытых позиций
if (_currentPosition == 0)
{
    _stateManager.DeleteState();
    Console.WriteLine("🗑️ State cleared - no open positions");
}
```

**FAQ:**

**Q: Что если state file повреждён?**
A: Бот начнёт с чистого листа. Проверьте баланс на бирже вручную, закройте позиции если нужно.

**Q: Можно ли редактировать state file вручную?**
A: Можно, но КРАЙНЕ опасно. Лучше закрыть все позиции и начать заново.

**Q: Где хранить state file в production?**
A: В той же директории что и бот, с регулярными backups в облако.

**Q: Нужно ли сохранять state в paper trading?**
A: Можно, но не критично. В paper trading нет реальных позиций на бирже.

**Q: Что делать если reconciliation показал mismatch?**
A:
1. Проверьте trade history на Binance
2. Если позиция закрылась по стопу/профиту - обновите equity
3. Если несоответствие непонятное - закройте позицию вручную

---

## Режим 7: Download Data (Загрузка данных)

### Что это?

Скачивание исторических данных для последующего использования в бэктесте.

### Как использовать?

```
Symbol: BTCUSDT                    ← Пара
Interval: 4h                       ← Таймфрейм
Start date (yyyy-MM-dd): 2023-01-01
End date (yyyy-MM-dd): 2024-01-01

Downloading BTCUSDT data... 100%

✓ Saved 2190 candles to Data/BTCUSDT_4h_2023-01-01_2024-01-01.csv
```

Теперь вы можете использовать эти данные без подключения к интернету.

---

# Часть 5: Понимание результатов

## Ключевые метрики

### 1. Total Return (Общая доходность)

```
Было: $10,000
Стало: $13,500
Total Return: +35%

Хорошо: > 15% годовых
Отлично: > 30% годовых
```

### 2. Max Drawdown (Максимальная просадка)

```
Это самое большое падение счёта от максимума.

Пример:
Счёт вырос до $15,000 (максимум)
Потом упал до $12,000
Потом вырос до $18,000

Max Drawdown = ($15,000 - $12,000) / $15,000 = 20%

Приемлемо: < 20%
Хорошо: < 15%
Отлично: < 10%
```

### 3. Sharpe Ratio (Коэффициент Шарпа)

```
Показывает: сколько прибыли вы получаете на единицу риска.

Sharpe < 0.5  — Плохо, слишком рискованно
Sharpe 0.5-1  — Удовлетворительно
Sharpe 1-2    — Хорошо ✅
Sharpe > 2    — Отлично ✅✅
```

### 4. Profit Factor (Фактор прибыли)

```
Profit Factor = Сумма прибыльных сделок / Сумма убыточных сделок

Пример:
Прибыли: $5,000
Убытки: $3,000
Profit Factor = 5000 / 3000 = 1.67

Profit Factor < 1.0  — Убыточная стратегия ❌
Profit Factor 1.0-1.5 — Маргинальная ⚠️
Profit Factor 1.5-2.0 — Хорошая ✅
Profit Factor > 2.0   — Отличная ✅✅
```

### 5. Win Rate (Процент прибыльных сделок)

```
Win Rate = Прибыльные сделки / Все сделки × 100%

Пример:
23 прибыльных из 47 сделок
Win Rate = 23/47 × 100% = 48.9%

⚠️ ВАЖНО: Win Rate сам по себе ничего не значит!

Можно зарабатывать с Win Rate 30%, если:
- Средняя прибыль = $300
- Средний убыток = $100
- Ожидание = 0.30 × $300 - 0.70 × $100 = $90 - $70 = +$20 на сделку ✅

Можно терять с Win Rate 70%, если:
- Средняя прибыль = $50
- Средний убыток = $200
- Ожидание = 0.70 × $50 - 0.30 × $200 = $35 - $60 = -$25 на сделку ❌
```

### 6. R-Multiple (Кратность R)

```
R = Размер риска на сделку

Если вы рискуете $150 на сделку:
- Прибыль $300 = +2R
- Прибыль $150 = +1R
- Убыток $150 = -1R
- Убыток $75 = -0.5R (закрыли раньше)

Хорошая стратегия имеет средний R > 0.5
```

---

## Как оценить результаты?

### Чек-лист хорошей стратегии:

```
┌─────────────────────────────────────────────────────────┐
│                   ЧЕК-ЛИСТ ОЦЕНКИ                        │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  ☐ Sharpe Ratio > 1.0                                   │
│  ☐ Max Drawdown < 20%                                   │
│  ☐ Profit Factor > 1.5                                  │
│  ☐ Количество сделок > 30 (статистика)                  │
│  ☐ Walk-Forward Efficiency > 50%                        │
│  ☐ Monte Carlo Ruin Probability < 5%                    │
│  ☐ OOS результаты похожи на IS                          │
│                                                          │
│  Если все ☑ — стратегия готова к Paper Trading          │
│  Если 5+ из 7 — можно пробовать осторожно               │
│  Если меньше 5 — нужна доработка                        │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

---

# Часть 6: Пошаговый пример работы

## Сценарий: Первый запуск бота

Вы только что установили бота и хотите понять, как он работает.

### Шаг 1: Скачайте данные

```bash
dotnet run
```

Выберите: **Download Data**

```
Symbol: BTCUSDT
Interval: 4h
Start date: 2023-01-01
End date: 2024-01-01

✓ Saved 2190 candles to Data/BTCUSDT_4h_2023-01-01_2024-01-01.csv
```

### Шаг 2: Запустите бэктест

Выберите: **Backtest**

```
Data source: Load from CSV file
Select file: BTCUSDT_4h_2023-01-01_2024-01-01.csv

Risk per trade (%): 1.5
Max portfolio heat (%): 15
Max drawdown circuit breaker (%): 20
Max daily drawdown (%): 3
ATR stop multiplier: 2.5
Take profit ratio: 1.5

Use default strategy settings? Yes
Initial capital (USDT): 10000

Running backtest...
```

### Шаг 3: Проанализируйте результаты

```
═══════════════════════ Backtest Results ═══════════════════════

┌────────────────────┬─────────────┐
│ Final Capital      │ $12,340.00  │
│ Total Return       │ +23.40%     │
│ Max Drawdown       │ -14.56%     │
│ Sharpe Ratio       │ 1.45        │
│ Profit Factor      │ 1.72        │
│ Total Trades       │ 52          │
│ Win Rate           │ 46.2%       │
└────────────────────┴─────────────┘

Assessment:
✓ Good risk-adjusted returns
✓ Well-controlled drawdowns
✓ Strong profit factor
⚠ Low win rate - ensure avg win > avg loss
```

**Интерпретация**:
- Заработали бы 23.4% за год — неплохо!
- Просадка 14.56% — в пределах нормы
- Sharpe 1.45 — хороший показатель
- Win Rate 46.2% — ниже 50%, но это нормально для трендовой стратегии

### Шаг 4: Проверьте надёжность (Walk-Forward)

Выберите: **Walk-Forward Analysis**

```
═══════════════ Walk-Forward Analysis ═══════════════

┌─────────────────────────┬─────────────┐
│ Walk-Forward Efficiency │ 62.3%       │  ✅ > 50%
│ OOS Consistency         │ 83.3%       │  ✅ > 80%
│ Strategy Robust?        │ YES         │  ✅
└─────────────────────────┴─────────────┘
```

**Интерпретация**: Стратегия работает не случайно, результаты надёжные.

### Шаг 5: Оцените риски (Monte Carlo)

Выберите: **Monte Carlo Simulation**

```
Number of simulations: 1000

═══════════════ Monte Carlo Analysis ═══════════════

┌────────────────────────┬─────────────┐
│ Median Return          │ +21.5%      │
│ 5th Percentile Return  │ +8.2%       │
│ 95th Percentile DD     │ -18.7%      │
│ Ruin Probability       │ 0.2%        │  ✅ < 1%
└────────────────────────┴─────────────┘

Risk Assessment:
Excellent confidence level. Strategy shows consistent
performance across trade order variations.
```

**Интерпретация**: Даже в худших случаях ожидается прибыль ~8%, вероятность разорения почти нулевая.

### Шаг 6: Потренируйтесь (Paper Trading)

Выберите: **Live Trading (Paper)**

```
Use Binance Testnet? Yes
Testnet API Key: [ваш ключ]
Testnet API Secret: [ваш секрет]
Symbol: BTCUSDT
Interval: 4h
Trading mode: Spot (no margin)
Initial capital: 10000

Starting trader... Press Ctrl+C to stop
```

**Рекомендация**: Торгуйте в Paper режиме минимум 2 недели, прежде чем переходить к реальным деньгам.

---

# Часть 7: Частые вопросы

## Общие вопросы

### Q: Сколько можно заработать?

**A**: Это зависит от многих факторов. На основе бэктестов:
- **Оптимистичный сценарий**: 15-30% годовых
- **Реалистичный сценарий**: 5-15% годовых
- **Пессимистичный сценарий**: 0% или убыток

⚠️ **Важно**: Прошлые результаты НЕ гарантируют будущих!

### Q: Сколько денег нужно для начала?

**A**: Технически — от $100. Рекомендуется:
- **Минимум для теста**: $500
- **Комфортный старт**: $1,000-5,000
- **Никогда**: больше, чем готовы потерять полностью

### Q: Робот торгует 24/7?

**A**: Да, криптобиржи работают круглосуточно. Робот будет торговать, пока запущен.

### Q: Нужно ли следить за роботом?

**A**: Желательно проверять:
- Раз в день: всё ли работает, нет ли ошибок
- Раз в неделю: анализ результатов
- Сразу при получении уведомлений (если настроены)

---

## Технические вопросы

### Q: Что делать если робот остановился?

**A**:
1. Проверьте интернет-соединение
2. Проверьте, работает ли Binance (status.binance.com)
3. Перезапустите робота: `dotnet run`
4. Проверьте логи на ошибки

### Q: Как изменить настройки?

**A**: При запуске выберите "No" на вопрос "Use default settings?" и введите свои значения.

### Q: Данные хранятся локально?

**A**: Да, в папке `Data/` сохраняются CSV-файлы с историческими данными.

---

## Вопросы о стратегии

### Q: Почему робот не торгует?

**A**: Возможные причины:
1. **Нет тренда** — ADX < 25, робот ждёт
2. **Недостаточный объём** — Volume < 1.5x от среднего
3. **Превышен лимит риска** — достигнут max drawdown или heat
4. **Превышен дневной лимит** — потеряли больше 3% за день (новое!)
5. **Технические проблемы** — проверьте подключение

### Q: Можно ли торговать другие пары?

**A**: Да! Замените BTCUSDT на:
- ETHUSDT (Ethereum)
- SOLUSDT (Solana)
- BNBUSDT (Binance Coin)
- И любые другие пары на Binance

### Q: Почему Win Rate меньше 50%?

**A**: Это нормально для трендовых стратегий! Главное:
- Средняя прибыль > Средний убыток
- Profit Factor > 1.5
- Положительное математическое ожидание

---

# Часть 8: Предупреждения о рисках

## Важные предупреждения

```
╔═══════════════════════════════════════════════════════════════╗
║                                                                ║
║   1. ВЫ МОЖЕТЕ ПОТЕРЯТЬ ВСЕ ДЕНЬГИ                            ║
║                                                                ║
║   Торговля криптовалютой — это высокорисковая деятельность.   ║
║   Цены могут упасть на 50-90% за короткое время.              ║
║   Робот НЕ гарантирует прибыль.                               ║
║                                                                ║
╠═══════════════════════════════════════════════════════════════╣
║                                                                ║
║   2. ПРОШЛЫЕ РЕЗУЛЬТАТЫ ≠ БУДУЩИЕ                             ║
║                                                                ║
║   То, что стратегия работала в прошлом, не значит,           ║
║   что она будет работать в будущем. Рынок меняется.          ║
║                                                                ║
╠═══════════════════════════════════════════════════════════════╣
║                                                                ║
║   3. ТЕХНИЧЕСКИЕ РИСКИ                                        ║
║                                                                ║
║   - Сбой интернета                                            ║
║   - Сбой биржи                                                ║
║   - Ошибки в программе                                        ║
║   - Хакерские атаки                                           ║
║                                                                ║
╠═══════════════════════════════════════════════════════════════╣
║                                                                ║
║   4. ЭМОЦИОНАЛЬНЫЕ РИСКИ                                      ║
║                                                                ║
║   - Желание "отыграться" после убытков                        ║
║   - Жадность при прибыли                                      ║
║   - Паника при просадках                                      ║
║                                                                ║
╠═══════════════════════════════════════════════════════════════╣
║                                                                ║
║   5. ПРАВОВЫЕ РИСКИ                                           ║
║                                                                ║
║   Законодательство о криптовалютах различается по странам.    ║
║   Убедитесь, что торговля легальна в вашей юрисдикции.       ║
║                                                                ║
╚═══════════════════════════════════════════════════════════════╝
```

## Золотые правила безопасности

```
┌─────────────────────────────────────────────────────────┐
│               ЗОЛОТЫЕ ПРАВИЛА                            │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  1. Инвестируйте только свободные деньги                │
│     Не берите кредиты. Не используйте деньги на жизнь.  │
│                                                          │
│  2. Начинайте с малого                                   │
│     $100-500 для первых месяцев. Увеличивайте постепенно│
│                                                          │
│  3. Тестируйте перед реальной торговлей                 │
│     Backtest → Walk-Forward → Monte Carlo → Paper → Real│
│                                                          │
│  4. Не меняйте настройки под влиянием эмоций            │
│     После убыточного дня не "чините" стратегию.         │
│                                                          │
│  5. Ведите журнал                                        │
│     Записывайте сделки, анализируйте ошибки.            │
│                                                          │
│  6. Установите лимиты                                    │
│     Дневной лимит потерь. Недельный. Месячный.          │
│                                                          │
│  7. Имейте план выхода                                   │
│     Знайте заранее: при какой просадке остановитесь.    │
│                                                          │
│  8. Не кладите все яйца в одну корзину                  │
│     Диверсифицируйте. Держите часть в стейблкоинах.     │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

## Когда НЕ торговать

```
❌ Когда вам нужны эти деньги для жизни
❌ Когда вы эмоционально нестабильны
❌ Когда вы не понимаете как работает робот
❌ Когда у вас нет времени следить за роботом
❌ Когда бэктесты показывают плохие результаты
❌ Когда вы хотите "быстро разбогатеть"
```

---

## Контрольные вопросы перед реальной торговлей

Прежде чем торговать реальными деньгами, честно ответьте:

```
☐ Я понимаю, что могу потерять все вложенные деньги
☐ Эти деньги — свободные, я могу их потерять без последствий
☐ Я протестировал стратегию на исторических данных
☐ Результаты Walk-Forward подтвердили надёжность
☐ Я торговал в Paper режиме минимум 2 недели
☐ Я понимаю все метрики и показатели
☐ У меня есть план действий при просадке
☐ Я не буду менять настройки под влиянием эмоций
☐ У меня есть резервный план если робот сломается
☐ Я проконсультировался о налогах и законности
```

Если хотя бы один пункт — "Нет", продолжите подготовку.

---

## Контакты и поддержка

- **Документация**: этот файл и README.md
- **Исходный код**: GitHub репозиторий
- **Вопросы**: создайте Issue в репозитории

---

*Удачи в торговле! Помните: знание и дисциплина — ваши лучшие инструменты.*

---

*Документ создан: 2026-01-01*
*Версия: 1.0*
