services:
  signalbot:
    build:
      context: ..
      dockerfile: SignalBot/SignalBot.Dockerfile
    container_name: signalbot
    restart: unless-stopped

    environment:
      - TZ=${TZ:-UTC}
      # Binance API credentials
      - TRADING_BinanceApi__ApiKey=${TRADING_BinanceApi__ApiKey:-}
      - TRADING_BinanceApi__ApiSecret=${TRADING_BinanceApi__ApiSecret:-}
      - TRADING_BinanceApi__UseTestnet=${TRADING_BinanceApi__UseTestnet:-true}
      # SignalBot configuration
      - TRADING_SignalBot__EnableFuturesTrading=${TRADING_SignalBot__EnableFuturesTrading:-true}
      - TRADING_SignalBot__State__StatePath=/app/data/state/signalbot_state.json
      - TRADING_SignalBot__State__StatisticsPath=/app/data/state/signalbot_statistics.json
      - TRADING_SignalBot__Telegram__SessionPath=/app/data/telegram/telegram_session.dat
      # Telegram connection
      - TRADING_SignalBot__Telegram__ApiId=${TRADING_SignalBot__Telegram__ApiId:-}
      - TRADING_SignalBot__Telegram__ApiHash=${TRADING_SignalBot__Telegram__ApiHash:-}
      - TRADING_SignalBot__Telegram__PhoneNumber=${TRADING_SignalBot__Telegram__PhoneNumber:-}
      # Telegram notifications (optional)
      - TRADING_SignalBot__Notifications__TelegramBotToken=${TRADING_SignalBot__Notifications__TelegramBotToken:-}
      - TRADING_SignalBot__Notifications__TelegramChatId=${TRADING_SignalBot__Notifications__TelegramChatId:-}

    volumes:
      # State and session persistence
      - ./data/state:/app/data/state
      - ./data/telegram:/app/data/telegram
      # Application logs (Serilog output)
      - ./data/logs:/app/logs
      # Mount .env file for configuration
      - ./.env:/app/.env:ro

    deploy:
      resources:
        limits:
          memory: 1G
        reservations:
          memory: 256M

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
